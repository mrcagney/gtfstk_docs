
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>GTFSTK 10.0.4 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">GTFSTK 10.0.4 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html#document-index">Table of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-introduction">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#authors">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#conventions">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-modules">Module constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.helpers">Module helpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.validators">Module validators</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.cleaners">Module cleaners</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.calendar">Module calendar</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.routes">Module routes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.shapes">Module shapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.stop_times">Module stop_times</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.stops">Module stops</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.trips">Module trips</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.miscellany">Module miscellany</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#module-gtfstk.feed">Module feed</a></li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="gtfstk-version-documentation">
<h1>GTFSTK 10.0.4 Documentation<a class="headerlink" href="#gtfstk-version-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-introduction"></span><div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>GTFSTK is a Python 3.6+ tool kit for analyzing <a class="reference external" href="https://en.wikipedia.org/wiki/GTFS">General Transit Feed Specification (GTFS)</a> data in memory without a database.
It uses Pandas and Shapely to do the heavy lifting.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">gtfstk</span></code>.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>You can play with <code class="docutils literal notranslate"><span class="pre">ipynb/examples.ipynb</span></code> in a Jupyter notebook</p>
</div>
<div class="section" id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Alex Raichev, 2014-05</li>
<li><a class="reference external" href="https://github.com/cjer">cjer</a>, 2018-07</li>
<li><a class="reference external" href="https://github.com/paulswartz">Paul Swartz</a>, 2018-08</li>
</ul>
</div>
<div class="section" id="conventions">
<h2>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>In conformance with GTFS, dates are encoded as YYYYMMDD date strings, and times are encoded as HH:MM:SS time strings with the possibility that HH &gt; 24. <strong>Watch out</strong> for that possibility, because it has counterintuitive consequences; see e.g. <a class="reference internal" href="index.html#gtfstk.trips.is_active_trip" title="gtfstk.trips.is_active_trip"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.is_active_trip()</span></code></a>, which is used in <a class="reference internal" href="index.html#gtfstk.routes.compute_route_stats" title="gtfstk.routes.compute_route_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">routes.compute_route_stats()</span></code></a>,  <a class="reference internal" href="index.html#gtfstk.stops.compute_stop_stats" title="gtfstk.stops.compute_stop_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">stops.compute_stop_stats()</span></code></a>, and <a class="reference internal" href="index.html#gtfstk.miscellany.compute_feed_stats" title="gtfstk.miscellany.compute_feed_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">miscellany.compute_feed_stats()</span></code></a>.</li>
<li>‘DataFrame’ and ‘Series’ refer to Pandas DataFrame and Series objects,
respectively</li>
</ul>
</div>
<span id="document-modules"></span><div class="section" id="module-gtfstk.constants">
<span id="module-constants"></span><h2>Module constants<a class="headerlink" href="#module-gtfstk.constants" title="Permalink to this headline">¶</a></h2>
<p>Constants useful across modules.</p>
<dl class="data">
<dt id="gtfstk.constants.COLORS_SET2">
<code class="descclassname">gtfstk.constants.</code><code class="descname">COLORS_SET2</code><em class="property"> = ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f', '#e5c494', '#b3b3b3']</em><a class="headerlink" href="#gtfstk.constants.COLORS_SET2" title="Permalink to this definition">¶</a></dt>
<dd><p>Colorbrewer 8-class Set2 colors</p>
</dd></dl>

<dl class="data">
<dt id="gtfstk.constants.DIST_UNITS">
<code class="descclassname">gtfstk.constants.</code><code class="descname">DIST_UNITS</code><em class="property"> = ['ft', 'mi', 'm', 'km']</em><a class="headerlink" href="#gtfstk.constants.DIST_UNITS" title="Permalink to this definition">¶</a></dt>
<dd><p>Valid distance units</p>
</dd></dl>

<dl class="data">
<dt id="gtfstk.constants.FEED_ATTRS">
<code class="descclassname">gtfstk.constants.</code><code class="descname">FEED_ATTRS</code><em class="property"> = ['agency', 'calendar', 'calendar_dates', 'fare_attributes', 'fare_rules', 'feed_info', 'frequencies', 'routes', 'shapes', 'stops', 'stop_times', 'trips', 'transfers', 'dist_units', '_trips_i', '_calendar_i', '_calendar_dates_g']</em><a class="headerlink" href="#gtfstk.constants.FEED_ATTRS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="gtfstk.constants.FEED_ATTRS_1">
<code class="descclassname">gtfstk.constants.</code><code class="descname">FEED_ATTRS_1</code><em class="property"> = ['agency', 'calendar', 'calendar_dates', 'fare_attributes', 'fare_rules', 'feed_info', 'frequencies', 'routes', 'shapes', 'stops', 'stop_times', 'trips', 'transfers', 'dist_units']</em><a class="headerlink" href="#gtfstk.constants.FEED_ATTRS_1" title="Permalink to this definition">¶</a></dt>
<dd><p>Primary feed attributes</p>
</dd></dl>

<dl class="data">
<dt id="gtfstk.constants.FEED_ATTRS_2">
<code class="descclassname">gtfstk.constants.</code><code class="descname">FEED_ATTRS_2</code><em class="property"> = ['_trips_i', '_calendar_i', '_calendar_dates_g']</em><a class="headerlink" href="#gtfstk.constants.FEED_ATTRS_2" title="Permalink to this definition">¶</a></dt>
<dd><p>Secondary feed attributes; derived from primary ones</p>
</dd></dl>

<dl class="data">
<dt id="gtfstk.constants.INT_COLS">
<code class="descclassname">gtfstk.constants.</code><code class="descname">INT_COLS</code><em class="property"> = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday', 'exception_type', 'payment_method', 'transfers', 'transfer_duration', 'headway_secs', 'exact_times', 'route_type', 'shape_pt_sequence', 'location_type', 'wheelchair_boarding', 'stop_sequence', 'pickup_type', 'drop_off_type', 'timepoint', 'transfer_type', 'min_transfer_time', 'direction_id', 'wheelchair_accessible', 'bikes_allowed']</em><a class="headerlink" href="#gtfstk.constants.INT_COLS" title="Permalink to this definition">¶</a></dt>
<dd><p>Columns that must be formatted as integers when outputting GTFS</p>
</dd></dl>

<dl class="data">
<dt id="gtfstk.constants.STR_COLS">
<code class="descclassname">gtfstk.constants.</code><code class="descname">STR_COLS</code><em class="property"> = ['agency_id', 'agency_name', 'agency_url', 'agency_timezone', 'agency_lang', 'agency_phone', 'agency_fare_url', 'agency_email', 'service_id', 'start_date', 'end_date', 'service_id', 'date', 'fare_id', 'currency_type', 'fare_id', 'route_id', 'origin_id', 'destination_id', 'contains_id', 'feed_publisher_name', 'feed_publisher_url', 'feed_lang', 'feed_start_date', 'feed_end_date', 'feed_version', 'trip_id', 'start_time', 'end_time', 'route_id', 'agency_id', 'route_short_name', 'route_long_name', 'route_desc', 'route_url', 'route_color', 'route_text_color', 'shape_id', 'stop_id', 'stop_code', 'stop_name', 'stop_desc', 'zone_id', 'stop_url', 'parent_station', 'stop_timezone', 'trip_id', 'arrival_time', 'departure_time', 'stop_id', 'stop_headsign', 'from_stop_id', 'to_stop_id', 'route_id', 'service_id', 'trip_id', 'trip_headsign', 'trip_short_name', 'block_id', 'shape_id']</em><a class="headerlink" href="#gtfstk.constants.STR_COLS" title="Permalink to this definition">¶</a></dt>
<dd><p>Columns that must be read as strings by Pandas</p>
</dd></dl>

<dl class="data">
<dt id="gtfstk.constants.WGS84">
<code class="descclassname">gtfstk.constants.</code><code class="descname">WGS84</code><em class="property"> = {'init': 'epsg:4326'}</em><a class="headerlink" href="#gtfstk.constants.WGS84" title="Permalink to this definition">¶</a></dt>
<dd><p>WGS84 coordinate reference system for Geopandas</p>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.helpers">
<span id="module-helpers"></span><h2>Module helpers<a class="headerlink" href="#module-gtfstk.helpers" title="Permalink to this headline">¶</a></h2>
<p>Functions useful across modules.</p>
<dl class="function">
<dt id="gtfstk.helpers.almost_equal">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">almost_equal</code><span class="sig-paren">(</span><em>f: pandas.core.frame.DataFrame</em>, <em>g: pandas.core.frame.DataFrame</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.helpers.almost_equal" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if and only if the given DataFrames are equal after
sorting their columns names, sorting their values, and
reseting their indices.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.combine_time_series">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">combine_time_series</code><span class="sig-paren">(</span><em>time_series_dict: Dict</em>, <em>kind: str</em>, <em>*</em>, <em>split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.helpers.combine_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Combine the many time series DataFrames in the given dictionary
into one time series DataFrame with hierarchical columns.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>time_series_dict</strong> (<em>dictionary</em>) – Has the form string -&gt; time series</li>
<li><strong>kind</strong> (<em>string</em>) – <code class="docutils literal notranslate"><span class="pre">'route'</span></code> or <code class="docutils literal notranslate"><span class="pre">'stop'</span></code></li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then assume the original time series contains data
separated by trip direction; otherwise, assume not.
The separation is indicated by a suffix <code class="docutils literal notranslate"><span class="pre">'-0'</span></code> (direction 0)
or <code class="docutils literal notranslate"><span class="pre">'-1'</span></code> (direction 1) in the route ID or stop ID column
values.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Columns are hierarchical (multi-index).
The top level columns are the keys of the dictionary and
the second level columns are <code class="docutils literal notranslate"><span class="pre">'route_id'</span></code> and
<code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code>, if <code class="docutils literal notranslate"><span class="pre">kind</span> <span class="pre">==</span> <span class="pre">'route'</span></code>, or ‘stop_id’ and
<code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code>, if <code class="docutils literal notranslate"><span class="pre">kind</span> <span class="pre">==</span> <span class="pre">'stop'</span></code>.
If <code class="docutils literal notranslate"><span class="pre">split_directions</span></code>, then third column is
<code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code>; otherwise, there is no <code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code>
column.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.datestr_to_date">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">datestr_to_date</code><span class="sig-paren">(</span><em>x: Union[datetime.date, str], format_str: str = '%Y%m%d', *, inverse: bool = False</em><span class="sig-paren">)</span> &#x2192; Union[str, datetime.date]<a class="headerlink" href="#gtfstk.helpers.datestr_to_date" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a string <code class="docutils literal notranslate"><span class="pre">x</span></code> representing a date in the given format,
convert it to a Datetime Date object and return the result.
If <code class="docutils literal notranslate"><span class="pre">inverse</span></code>, then assume that <code class="docutils literal notranslate"><span class="pre">x</span></code> is a date object and return
its corresponding string in the given format.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.downsample">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">downsample</code><span class="sig-paren">(</span><em>time_series: pandas.core.frame.DataFrame</em>, <em>freq: str</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.helpers.downsample" title="Permalink to this definition">¶</a></dt>
<dd><p>Downsample the given route, stop, or feed time series,
(outputs of <a class="reference internal" href="#gtfstk.routes.compute_route_time_series" title="gtfstk.routes.compute_route_time_series"><code class="xref py py-func docutils literal notranslate"><span class="pre">routes.compute_route_time_series()</span></code></a>,
<a class="reference internal" href="#gtfstk.stops.compute_stop_time_series" title="gtfstk.stops.compute_stop_time_series"><code class="xref py py-func docutils literal notranslate"><span class="pre">stops.compute_stop_time_series()</span></code></a>, or
<a class="reference internal" href="#gtfstk.miscellany.compute_feed_time_series" title="gtfstk.miscellany.compute_feed_time_series"><code class="xref py py-func docutils literal notranslate"><span class="pre">miscellany.compute_feed_time_series()</span></code></a>,
respectively) to the given Pandas frequency string (e.g. ‘15Min’).
Return the given time series unchanged if the given frequency is
shorter than the original frequency.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.get_active_trips_df">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">get_active_trips_df</code><span class="sig-paren">(</span><em>trip_times: pandas.core.frame.DataFrame</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.helpers.get_active_trips_df" title="Permalink to this definition">¶</a></dt>
<dd><p>Count the number of trips in <code class="docutils literal notranslate"><span class="pre">trip_times</span></code> that are active
at any given time.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>trip_times</strong> (<em>DataFrame</em>) – <p>Contains columns</p>
<ul class="simple">
<li>start_time: start time of the trip in seconds past midnight</li>
<li>end_time: end time of the trip in seconds past midnight</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">index is times from midnight when trips start and end,
values are number of active trips for that time</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">Series</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.get_convert_dist">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">get_convert_dist</code><span class="sig-paren">(</span><em>dist_units_in: str</em>, <em>dist_units_out: str</em><span class="sig-paren">)</span> &#x2192; Callable[float, float]<a class="headerlink" href="#gtfstk.helpers.get_convert_dist" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a function of the form</p>
<blockquote>
<div>distance in the units <code class="docutils literal notranslate"><span class="pre">dist_units_in</span></code> -&gt;
distance in the units <code class="docutils literal notranslate"><span class="pre">dist_units_out</span></code></div></blockquote>
<p>Only supports distance units in <code class="xref py py-const docutils literal notranslate"><span class="pre">constants.DIST_UNITS</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.get_max_runs">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">get_max_runs</code><span class="sig-paren">(</span><em>x</em><span class="sig-paren">)</span> &#x2192; numpy.array<a class="headerlink" href="#gtfstk.helpers.get_max_runs" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of numbers, return a NumPy array of pairs
(start index, end index + 1) of the runs of max value.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_max_runs</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="go">array([[0, 1],</span>
<span class="go">       [3, 5]])</span>
</pre></div>
</div>
<p>Assume x is not empty.
Recipe comes from
<a class="reference external" href="http://stackoverflow.com/questions/1066758/find-length-of-sequences-of-identical-values-in-a-numpy-array">Stack Overflow</a>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.get_peak_indices">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">get_peak_indices</code><span class="sig-paren">(</span><em>times: List</em>, <em>counts: List</em><span class="sig-paren">)</span> &#x2192; numpy.array<a class="headerlink" href="#gtfstk.helpers.get_peak_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an increasing list of times as seconds past midnight and a
list of trip counts at those respective times,
return a pair of indices i, j such that times[i] to times[j] is
the first longest time period such that for all i &lt;= x &lt; j,
counts[x] is the max of counts.
Assume times and counts have the same nonzero length.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.get_segment_length">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">get_segment_length</code><span class="sig-paren">(</span><em>linestring: shapely.geometry.linestring.LineString</em>, <em>p: shapely.geometry.point.Point</em>, <em>q: Optional[shapely.geometry.point.Point] = None</em><span class="sig-paren">)</span> &#x2192; float<a class="headerlink" href="#gtfstk.helpers.get_segment_length" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a Shapely linestring and two Shapely points,
project the points onto the linestring, and return the distance
along the linestring between the two points.
If <code class="docutils literal notranslate"><span class="pre">q</span> <span class="pre">is</span> <span class="pre">None</span></code>, then return the distance from the start of the
linestring to the projection of <code class="docutils literal notranslate"><span class="pre">p</span></code>.
The distance is measured in the native coordinates of the linestring.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.get_utm_crs">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">get_utm_crs</code><span class="sig-paren">(</span><em>lat: float</em>, <em>lon: float</em><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#gtfstk.helpers.get_utm_crs" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a GeoPandas coordinate reference system (CRS) dictionary
corresponding to the UTM projection appropriate to the given WGS84
latitude and longitude.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.is_not_null">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">is_not_null</code><span class="sig-paren">(</span><em>df: pandas.core.frame.DataFrame</em>, <em>col_name: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.helpers.is_not_null" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the given DataFrame has a column of the given
name (string), and there exists at least one non-NaN value in that
column; return <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.linestring_to_utm">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">linestring_to_utm</code><span class="sig-paren">(</span><em>linestring: shapely.geometry.linestring.LineString</em><span class="sig-paren">)</span> &#x2192; shapely.geometry.linestring.LineString<a class="headerlink" href="#gtfstk.helpers.linestring_to_utm" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a Shapely LineString in WGS84 coordinates,
convert it to the appropriate UTM coordinates.
If <code class="docutils literal notranslate"><span class="pre">inverse</span></code>, then do the inverse.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.make_html">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">make_html</code><span class="sig-paren">(</span><em>d: Dict</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#gtfstk.helpers.make_html" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the given dictionary into an HTML table (string) with
two columns: keys of dictionary, values of dictionary.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.restack_time_series">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">restack_time_series</code><span class="sig-paren">(</span><em>unstacked_time_series: pandas.core.frame.DataFrame</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.helpers.restack_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an unstacked stop, route, or feed time series in the form
output by the function <a class="reference internal" href="#gtfstk.helpers.unstack_time_series" title="gtfstk.helpers.unstack_time_series"><code class="xref py py-func docutils literal notranslate"><span class="pre">unstack_time_series()</span></code></a>, restack it into
its original time series form.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.timestr_mod24">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">timestr_mod24</code><span class="sig-paren">(</span><em>timestr: str</em><span class="sig-paren">)</span> &#x2192; int<a class="headerlink" href="#gtfstk.helpers.timestr_mod24" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a GTFS HH:MM:SS time string, return a timestring in the same
format but with the hours taken modulo 24.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.timestr_to_seconds">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">timestr_to_seconds</code><span class="sig-paren">(</span><em>x: Union[datetime.date, str], *, inverse: bool = False, mod24: bool = False</em><span class="sig-paren">)</span> &#x2192; int<a class="headerlink" href="#gtfstk.helpers.timestr_to_seconds" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an HH:MM:SS time string <code class="docutils literal notranslate"><span class="pre">x</span></code>, return the number of seconds
past midnight that it represents.
In keeping with GTFS standards, the hours entry may be greater than
23.
If <code class="docutils literal notranslate"><span class="pre">mod24</span></code>, then return the number of seconds modulo <code class="docutils literal notranslate"><span class="pre">24*3600</span></code>.
If <code class="docutils literal notranslate"><span class="pre">inverse</span></code>, then do the inverse operation.
In this case, if <code class="docutils literal notranslate"><span class="pre">mod24</span></code> also, then first take the number of
seconds modulo <code class="docutils literal notranslate"><span class="pre">24*3600</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.unstack_time_series">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">unstack_time_series</code><span class="sig-paren">(</span><em>time_series: pandas.core.frame.DataFrame</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.helpers.unstack_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a route, stop, or feed time series of the form output by the functions,
<code class="xref py py-func docutils literal notranslate"><span class="pre">compute_stop_time_series()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">compute_route_time_series()</span></code>, or
<code class="xref py py-func docutils literal notranslate"><span class="pre">compute_feed_time_series()</span></code>, respectively, unstack it to return a DataFrame
of with the columns:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&quot;datetime&quot;</span></code></li>
<li>the columns <code class="docutils literal notranslate"><span class="pre">time_series.columns.names</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;value&quot;</span></code>: value at the datetime and other columns</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.helpers.weekday_to_str">
<code class="descclassname">gtfstk.helpers.</code><code class="descname">weekday_to_str</code><span class="sig-paren">(</span><em>weekday: Union[int, str], *, inverse: bool = False</em><span class="sig-paren">)</span> &#x2192; Union[int, str]<a class="headerlink" href="#gtfstk.helpers.weekday_to_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a weekday number (integer in the range 0, 1, …, 6),
return its corresponding weekday name as a lowercase string.
Here 0 -&gt; ‘monday’, 1 -&gt; ‘tuesday’, and so on.
If <code class="docutils literal notranslate"><span class="pre">inverse</span></code>, then perform the inverse operation.</p>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.validators">
<span id="module-validators"></span><h2>Module validators<a class="headerlink" href="#module-gtfstk.validators" title="Permalink to this headline">¶</a></h2>
<p>Functions about validation.</p>
<dl class="function">
<dt id="gtfstk.validators.check_agency">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_agency</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_agency" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that <code class="docutils literal notranslate"><span class="pre">feed.agency</span></code> follows the GTFS.
Return a list of problems of the form described in
<a class="reference internal" href="#gtfstk.validators.check_table" title="gtfstk.validators.check_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_table()</span></code></a>;
the list will be empty if no problems are found.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_calendar">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_calendar</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_calendar" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.calendar</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_calendar_dates">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_calendar_dates</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_calendar_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.calendar_dates</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_column">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_column</code><span class="sig-paren">(</span><em>problems: List</em>, <em>table: str</em>, <em>df: pandas.core.frame.DataFrame</em>, <em>column: str</em>, <em>checker</em>, <em>message: Optional[str] = None</em>, <em>type_: str = 'error'</em>, <em>*</em>, <em>column_required: bool = True</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_column" title="Permalink to this definition">¶</a></dt>
<dd><p>Check the given column of the given GTFS with the given problem
checker.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>problems</strong> (<em>list</em>) – <p>A four-tuple containing</p>
<ol class="arabic">
<li>A problem type (string) equal to <code class="docutils literal notranslate"><span class="pre">'error'</span></code> or <code class="docutils literal notranslate"><span class="pre">'warning'</span></code>;
<code class="docutils literal notranslate"><span class="pre">'error'</span></code> means the GTFS is violated;
<code class="docutils literal notranslate"><span class="pre">'warning'</span></code> means there is a problem but it is not a
GTFS violation</li>
<li>A message (string) that describes the problem</li>
<li>A GTFS table name, e.g. <code class="docutils literal notranslate"><span class="pre">'routes'</span></code>, in which the problem
occurs</li>
<li>A list of rows (integers) of the table’s DataFrame where the
problem occurs</li>
</ol>
</li>
<li><strong>table</strong> (<em>string</em>) – Name of a GTFS table</li>
<li><strong>df</strong> (<em>DataFrame</em>) – The GTFS table corresponding to <code class="docutils literal notranslate"><span class="pre">table</span></code></li>
<li><strong>column</strong> (<em>string</em>) – A column of <code class="docutils literal notranslate"><span class="pre">df</span></code></li>
<li><strong>column_required</strong> (<em>boolean</em>) – <code class="docutils literal notranslate"><span class="pre">True</span></code> if and only if <code class="docutils literal notranslate"><span class="pre">column</span></code> is required
(and not optional) by the GTFS</li>
<li><strong>checker</strong> (<em>boolean valued unary function</em>) – Returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if and only if no problem is encountered</li>
<li><strong>message</strong> (<em>string</em><em> (</em><em>optional</em><em>)</em>) – Problem message, e.g. ‘Invalid route_id’.
Defaults to ‘Invalid <code class="docutils literal notranslate"><span class="pre">column</span></code>; maybe has extra space characters’</li>
<li><strong>type</strong> (<em>string</em>) – <code class="docutils literal notranslate"><span class="pre">'error'</span></code> or <code class="docutils literal notranslate"><span class="pre">'warning'</span></code> indicating the type of problem
encountered</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The <code class="docutils literal notranslate"><span class="pre">problems</span></code> list extended as follows.
Apply the checker to the column entries and record the indices
of <code class="docutils literal notranslate"><span class="pre">df</span></code> where the checker returns <code class="docutils literal notranslate"><span class="pre">False</span></code>.
If the list of indices of is nonempty, append to the problems the
item <code class="docutils literal notranslate"><span class="pre">[type_,</span> <span class="pre">problem,</span> <span class="pre">table,</span> <span class="pre">indices]</span></code>; otherwise do not
append anything.</p>
<p>If not <code class="docutils literal notranslate"><span class="pre">column_required</span></code>, then NaN entries will be ignored
before applying the checker.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_column_id">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_column_id</code><span class="sig-paren">(</span><em>problems: List</em>, <em>table: str</em>, <em>df: pandas.core.frame.DataFrame</em>, <em>column: str</em>, <em>*</em>, <em>column_required: bool = True</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_column_id" title="Permalink to this definition">¶</a></dt>
<dd><p>A specialization of <a class="reference internal" href="#gtfstk.validators.check_column" title="gtfstk.validators.check_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_column()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>problems</strong> (<em>list</em>) – <p>A four-tuple containing</p>
<ol class="arabic">
<li>A problem type (string) equal to <code class="docutils literal notranslate"><span class="pre">'error'</span></code> or <code class="docutils literal notranslate"><span class="pre">'warning'</span></code>;
<code class="docutils literal notranslate"><span class="pre">'error'</span></code> means the GTFS is violated;
<code class="docutils literal notranslate"><span class="pre">'warning'</span></code> means there is a problem but it is not a
GTFS violation</li>
<li>A message (string) that describes the problem</li>
<li>A GTFS table name, e.g. <code class="docutils literal notranslate"><span class="pre">'routes'</span></code>, in which the problem
occurs</li>
<li>A list of rows (integers) of the table’s DataFrame where the
problem occurs</li>
</ol>
</li>
<li><strong>table</strong> (<em>string</em>) – Name of a GTFS table</li>
<li><strong>df</strong> (<em>DataFrame</em>) – The GTFS table corresponding to <code class="docutils literal notranslate"><span class="pre">table</span></code></li>
<li><strong>column</strong> (<em>string</em>) – A column of <code class="docutils literal notranslate"><span class="pre">df</span></code></li>
<li><strong>column_required</strong> (<em>boolean</em>) – <code class="docutils literal notranslate"><span class="pre">True</span></code> if and only if <code class="docutils literal notranslate"><span class="pre">column</span></code> is required
(and not optional) by the GTFS</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The <code class="docutils literal notranslate"><span class="pre">problems</span></code> list extended as follows.
Record the indices of <code class="docutils literal notranslate"><span class="pre">df</span></code> where the given column has
duplicated entry or an invalid strings.
If the list of indices is nonempty, append to the problems the
item <code class="docutils literal notranslate"><span class="pre">[type_,</span> <span class="pre">problem,</span> <span class="pre">table,</span> <span class="pre">indices]</span></code>; otherwise do not
append anything.</p>
<p>If not <code class="docutils literal notranslate"><span class="pre">column_required</span></code>, then NaN entries will be ignored
in the checking.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_column_linked_id">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_column_linked_id</code><span class="sig-paren">(</span><em>problems: List</em>, <em>table: str</em>, <em>df: pandas.core.frame.DataFrame</em>, <em>column: str</em>, <em>target_df: pandas.core.frame.DataFrame</em>, <em>target_column: Optional[str] = None</em>, <em>*</em>, <em>column_required: bool = True</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_column_linked_id" title="Permalink to this definition">¶</a></dt>
<dd><p>A modified version of <a class="reference internal" href="#gtfstk.validators.check_column_id" title="gtfstk.validators.check_column_id"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_column_id()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>problems</strong> (<em>list</em>) – <p>A four-tuple containing</p>
<ol class="arabic">
<li>A problem type (string) equal to <code class="docutils literal notranslate"><span class="pre">'error'</span></code> or <code class="docutils literal notranslate"><span class="pre">'warning'</span></code>;
<code class="docutils literal notranslate"><span class="pre">'error'</span></code> means the GTFS is violated;
<code class="docutils literal notranslate"><span class="pre">'warning'</span></code> means there is a problem but it is not a
GTFS violation</li>
<li>A message (string) that describes the problem</li>
<li>A GTFS table name, e.g. <code class="docutils literal notranslate"><span class="pre">'routes'</span></code>, in which the problem
occurs</li>
<li>A list of rows (integers) of the table’s DataFrame where the
problem occurs</li>
</ol>
</li>
<li><strong>table</strong> (<em>string</em>) – Name of a GTFS table</li>
<li><strong>df</strong> (<em>DataFrame</em>) – The GTFS table corresponding to <code class="docutils literal notranslate"><span class="pre">table</span></code></li>
<li><strong>column</strong> (<em>string</em>) – A column of <code class="docutils literal notranslate"><span class="pre">df</span></code></li>
<li><strong>column_required</strong> (<em>boolean</em>) – <code class="docutils literal notranslate"><span class="pre">True</span></code> if and only if <code class="docutils literal notranslate"><span class="pre">column</span></code> is required
(and not optional) by the GTFS</li>
<li><strong>target_df</strong> (<em>DataFrame</em>) – A GTFS table</li>
<li><strong>target_column</strong> (<em>string</em>) – A column of <code class="docutils literal notranslate"><span class="pre">target_df</span></code>; defaults to <code class="docutils literal notranslate"><span class="pre">column_name</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The <code class="docutils literal notranslate"><span class="pre">problems</span></code> list extended as follows.
Record indices of <code class="docutils literal notranslate"><span class="pre">df</span></code> where the following condition is
violated: <code class="docutils literal notranslate"><span class="pre">column</span></code> contain IDs that are valid strings and are
present in <code class="docutils literal notranslate"><span class="pre">target_df</span></code> under the <code class="docutils literal notranslate"><span class="pre">target_column</span></code> name.
If the list of indices is nonempty, append to the problems the
item <code class="docutils literal notranslate"><span class="pre">[type_,</span> <span class="pre">problem,</span> <span class="pre">table,</span> <span class="pre">indices]</span></code>; otherwise do not
append anything.</p>
<p>If not <code class="docutils literal notranslate"><span class="pre">column_required</span></code>, then NaN entries will be ignored
in the checking.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_fare_attributes">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_fare_attributes</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_fare_attributes" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.calendar_dates</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_fare_rules">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_fare_rules</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_fare_rules" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.calendar_dates</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_feed_info">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_feed_info</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_feed_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.feed_info</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_for_invalid_columns">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_for_invalid_columns</code><span class="sig-paren">(</span><em>problems: List</em>, <em>table: str</em>, <em>df: pandas.core.frame.DataFrame</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_for_invalid_columns" title="Permalink to this definition">¶</a></dt>
<dd><p>Check for invalid columns in the given GTFS DataFrame.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>problems</strong> (<em>list</em>) – <p>A four-tuple containing</p>
<ol class="arabic">
<li>A problem type (string) equal to <code class="docutils literal notranslate"><span class="pre">'error'</span></code> or <code class="docutils literal notranslate"><span class="pre">'warning'</span></code>;
<code class="docutils literal notranslate"><span class="pre">'error'</span></code> means the GTFS is violated;
<code class="docutils literal notranslate"><span class="pre">'warning'</span></code> means there is a problem but it is not a
GTFS violation</li>
<li>A message (string) that describes the problem</li>
<li>A GTFS table name, e.g. <code class="docutils literal notranslate"><span class="pre">'routes'</span></code>, in which the problem
occurs</li>
<li>A list of rows (integers) of the table’s DataFrame where the
problem occurs</li>
</ol>
</li>
<li><strong>table</strong> (<em>string</em>) – Name of a GTFS table</li>
<li><strong>df</strong> (<em>DataFrame</em>) – The GTFS table corresponding to <code class="docutils literal notranslate"><span class="pre">table</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The <code class="docutils literal notranslate"><span class="pre">problems</span></code> list extended as follows.
Check whether the DataFrame contains extra columns not in the
GTFS and append to the problems list one warning for each extra
column.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_for_required_columns">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_for_required_columns</code><span class="sig-paren">(</span><em>problems: List</em>, <em>table: str</em>, <em>df: pandas.core.frame.DataFrame</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_for_required_columns" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that the given GTFS table has the required columns.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>problems</strong> (<em>list</em>) – <p>A four-tuple containing</p>
<ol class="arabic">
<li>A problem type (string) equal to <code class="docutils literal notranslate"><span class="pre">'error'</span></code> or <code class="docutils literal notranslate"><span class="pre">'warning'</span></code>;
<code class="docutils literal notranslate"><span class="pre">'error'</span></code> means the GTFS is violated;
<code class="docutils literal notranslate"><span class="pre">'warning'</span></code> means there is a problem but it is not a
GTFS violation</li>
<li>A message (string) that describes the problem</li>
<li>A GTFS table name, e.g. <code class="docutils literal notranslate"><span class="pre">'routes'</span></code>, in which the problem
occurs</li>
<li>A list of rows (integers) of the table’s DataFrame where the
problem occurs</li>
</ol>
</li>
<li><strong>table</strong> (<em>string</em>) – Name of a GTFS table</li>
<li><strong>df</strong> (<em>DataFrame</em>) – The GTFS table corresponding to <code class="docutils literal notranslate"><span class="pre">table</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The <code class="docutils literal notranslate"><span class="pre">problems</span></code> list extended as follows.
Check that the DataFrame contains the colums required by GTFS
and append to the problems list one error for each column
missing.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_frequencies">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_frequencies</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_frequencies" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.frequencies</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_routes">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_routes</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_shapes">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_shapes</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_stop_times">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_stop_times</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_stop_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_stops">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_stops</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_table">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_table</code><span class="sig-paren">(</span><em>problems: List</em>, <em>table: str</em>, <em>df: pandas.core.frame.DataFrame</em>, <em>condition</em>, <em>message: str</em>, <em>type_: str = 'error'</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Check the given GTFS table for the given problem condition.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>problems</strong> (<em>list</em>) – <p>A four-tuple containing</p>
<ol class="arabic">
<li>A problem type (string) equal to <code class="docutils literal notranslate"><span class="pre">'error'</span></code> or <code class="docutils literal notranslate"><span class="pre">'warning'</span></code>;
<code class="docutils literal notranslate"><span class="pre">'error'</span></code> means the GTFS is violated;
<code class="docutils literal notranslate"><span class="pre">'warning'</span></code> means there is a problem but it is not a
GTFS violation</li>
<li>A message (string) that describes the problem</li>
<li>A GTFS table name, e.g. <code class="docutils literal notranslate"><span class="pre">'routes'</span></code>, in which the problem
occurs</li>
<li>A list of rows (integers) of the table’s DataFrame where the
problem occurs</li>
</ol>
</li>
<li><strong>table</strong> (<em>string</em>) – Name of a GTFS table</li>
<li><strong>df</strong> (<em>DataFrame</em>) – The GTFS table corresponding to <code class="docutils literal notranslate"><span class="pre">table</span></code></li>
<li><strong>condition</strong> (<em>boolean expression</em>) – One involving <code class="docutils literal notranslate"><span class="pre">df</span></code>, e.g.`df[‘route_id’].map(is_valid_str)``</li>
<li><strong>message</strong> (<em>string</em>) – Problem message, e.g. <code class="docutils literal notranslate"><span class="pre">'Invalid</span> <span class="pre">route_id'</span></code></li>
<li><strong>type</strong> (<em>string</em>) – <code class="docutils literal notranslate"><span class="pre">'error'</span></code> or <code class="docutils literal notranslate"><span class="pre">'warning'</span></code> indicating the type of problem
encountered</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The <code class="docutils literal notranslate"><span class="pre">problems</span></code> list extended as follows.
Record the indices of <code class="docutils literal notranslate"><span class="pre">df</span></code> that statisfy the condition.
If the list of indices is nonempty, append to the
problems the item <code class="docutils literal notranslate"><span class="pre">[type_,</span> <span class="pre">message,</span> <span class="pre">table,</span> <span class="pre">indices]</span></code>;
otherwise do not append anything.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_transfers">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_transfers</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_transfers" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.transfers</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.check_trips">
<code class="descclassname">gtfstk.validators.</code><code class="descname">check_trips</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.validators.check_trips" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.format_problems">
<code class="descclassname">gtfstk.validators.</code><code class="descname">format_problems</code><span class="sig-paren">(</span><em>problems: List</em>, <em>*</em>, <em>as_df: bool = False</em><span class="sig-paren">)</span> &#x2192; Union[List, pandas.core.frame.DataFrame]<a class="headerlink" href="#gtfstk.validators.format_problems" title="Permalink to this definition">¶</a></dt>
<dd><p>Format the given problems list as a DataFrame.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>problems</strong> (<em>list</em>) – <p>A four-tuple containing</p>
<ol class="arabic">
<li>A problem type (string) equal to <code class="docutils literal notranslate"><span class="pre">'error'</span></code> or <code class="docutils literal notranslate"><span class="pre">'warning'</span></code>;
<code class="docutils literal notranslate"><span class="pre">'error'</span></code> means the GTFS is violated;
<code class="docutils literal notranslate"><span class="pre">'warning'</span></code> means there is a problem but it is not a
GTFS violation</li>
<li>A message (string) that describes the problem</li>
<li>A GTFS table name, e.g. <code class="docutils literal notranslate"><span class="pre">'routes'</span></code>, in which the problem
occurs</li>
<li>A list of rows (integers) of the table’s DataFrame where the
problem occurs</li>
</ol>
</li>
<li><strong>as_df</strong> (<em>boolean</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Return <code class="docutils literal notranslate"><span class="pre">problems</span></code> if not <code class="docutils literal notranslate"><span class="pre">as_df</span></code>; otherwise return a
DataFrame with the problems as rows and the columns
<code class="docutils literal notranslate"><span class="pre">['type',</span> <span class="pre">'message',</span> <span class="pre">'table',</span> <span class="pre">'rows']</span></code>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list or DataFrame</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.valid_color">
<code class="descclassname">gtfstk.validators.</code><code class="descname">valid_color</code><span class="sig-paren">(</span><em>x: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.validators.valid_color" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">x</span></code> a valid hexadecimal color string without
the leading hash; otherwise return <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.valid_currency">
<code class="descclassname">gtfstk.validators.</code><code class="descname">valid_currency</code><span class="sig-paren">(</span><em>x: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.validators.valid_currency" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">x</span></code> is a valid three-letter ISO 4217 currency
code, e.g. ‘AED’; otherwise return <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.valid_date">
<code class="descclassname">gtfstk.validators.</code><code class="descname">valid_date</code><span class="sig-paren">(</span><em>x: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.validators.valid_date" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrun <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">x</span></code> is a valid YYYYMMDD date;
otherwise return <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.valid_email">
<code class="descclassname">gtfstk.validators.</code><code class="descname">valid_email</code><span class="sig-paren">(</span><em>x: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.validators.valid_email" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">x</span></code> is a valid email address; otherwise return
<code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.valid_lang">
<code class="descclassname">gtfstk.validators.</code><code class="descname">valid_lang</code><span class="sig-paren">(</span><em>x: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.validators.valid_lang" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">x</span></code> is a valid two-letter ISO 639 language
code, e.g. ‘aa’; otherwise return <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.valid_str">
<code class="descclassname">gtfstk.validators.</code><code class="descname">valid_str</code><span class="sig-paren">(</span><em>x: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.validators.valid_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">x</span></code> is a non-blank string;
otherwise return <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.valid_time">
<code class="descclassname">gtfstk.validators.</code><code class="descname">valid_time</code><span class="sig-paren">(</span><em>x: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.validators.valid_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">x</span></code> is a valid H:MM:SS or HH:MM:SS time;
otherwise return <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.valid_timezone">
<code class="descclassname">gtfstk.validators.</code><code class="descname">valid_timezone</code><span class="sig-paren">(</span><em>x: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.validators.valid_timezone" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrun <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">x</span></code> is a valid human-readable timezone string,
e.g. ‘Africa/Abidjan’; otherwise return <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.valid_url">
<code class="descclassname">gtfstk.validators.</code><code class="descname">valid_url</code><span class="sig-paren">(</span><em>x: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.validators.valid_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">x</span></code> is a valid URL; otherwise return <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.validators.validate">
<code class="descclassname">gtfstk.validators.</code><code class="descname">validate</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_df: bool = True</em>, <em>include_warnings: bool = True</em><span class="sig-paren">)</span> &#x2192; Union[List, pandas.core.frame.DataFrame]<a class="headerlink" href="#gtfstk.validators.validate" title="Permalink to this definition">¶</a></dt>
<dd><p>Check whether the given feed satisfies the GTFS.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>as_df</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then return the resulting report as a DataFrame;
otherwise return the result as a list</li>
<li><strong>include_warnings</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then include problems of types <code class="docutils literal notranslate"><span class="pre">'error'</span></code> and
<code class="docutils literal notranslate"><span class="pre">'warning'</span></code>; otherwise, only return problems of type
<code class="docutils literal notranslate"><span class="pre">'error'</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Run all the table-checking functions: <a class="reference internal" href="#gtfstk.validators.check_agency" title="gtfstk.validators.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a>,
<a class="reference internal" href="#gtfstk.validators.check_calendar" title="gtfstk.validators.check_calendar"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_calendar()</span></code></a>, etc.
This yields a possibly empty list of items
[problem type, message, table, rows].
If <code class="docutils literal notranslate"><span class="pre">as_df</span></code>, then format the error list as a DataFrame with the
columns</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'type'</span></code>: ‘error’ or ‘warning’; ‘error’ means the GTFS is
violated; ‘warning’ means there is a problem but it’s not a
GTFS violation</li>
<li><code class="docutils literal notranslate"><span class="pre">'message'</span></code>: description of the problem</li>
<li><code class="docutils literal notranslate"><span class="pre">'table'</span></code>: table in which problem occurs, e.g. ‘routes’</li>
<li><code class="docutils literal notranslate"><span class="pre">'rows'</span></code>: rows of the table’s DataFrame where problem occurs</li>
</ul>
<p>Return early if the feed is missing required tables or required
columns.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list or DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>This function interprets the GTFS liberally, classifying problems
as warnings rather than errors where the GTFS is unclear.
For example if a trip_id listed in the trips table is not listed
in the stop times table (a trip with no stop times),
then that’s a warning and not an error.</li>
<li>Timing benchmark: on a 2.80 GHz processor machine with 16 GB of
memory, this function checks <a class="reference external" href="http://transitfeeds.com/p/translink/21/20170310">this 31 MB Southeast Queensland feed</a>
in 22 seconds, including warnings.</li>
</ul>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.cleaners">
<span id="module-cleaners"></span><h2>Module cleaners<a class="headerlink" href="#module-gtfstk.cleaners" title="Permalink to this headline">¶</a></h2>
<p>Functions about cleaning feeds.</p>
<dl class="function">
<dt id="gtfstk.cleaners.aggregate_routes">
<code class="descclassname">gtfstk.cleaners.</code><code class="descname">aggregate_routes</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>by: str = 'route_short_name'</em>, <em>route_id_prefix: str = 'route_'</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.cleaners.aggregate_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregate routes by route short name, say, and assign new route IDs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<em>&quot;Feed&quot;</em>) – </li>
<li><strong>by</strong> (<em>string</em>) – A column of <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li><strong>route_id_prefix</strong> (<em>string</em>) – Prefix to use when creating new route IDs</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The result is built from the given Feed as follows.
Group <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code> by the <code class="docutils literal notranslate"><span class="pre">by</span></code> column, and for each group</p>
<ol class="arabic simple">
<li>Choose the first route in the group</li>
<li>Assign a new route ID based on the given <code class="docutils literal notranslate"><span class="pre">route_id_prefix</span></code>
string and a running count, e.g. <code class="docutils literal notranslate"><span class="pre">'route_013'</span></code></li>
<li>Assign all the trips associated with routes in the group to
that first route</li>
<li>Update the route IDs in the other “Feed” tables</li>
</ol>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">“Feed”</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.cleaners.clean">
<code class="descclassname">gtfstk.cleaners.</code><code class="descname">clean</code><span class="sig-paren">(</span><em>feed: Feed</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.cleaners.clean" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#gtfstk.cleaners.clean_ids" title="gtfstk.cleaners.clean_ids"><code class="xref py py-func docutils literal notranslate"><span class="pre">clean_ids()</span></code></a></li>
<li><a class="reference internal" href="#gtfstk.cleaners.clean_times" title="gtfstk.cleaners.clean_times"><code class="xref py py-func docutils literal notranslate"><span class="pre">clean_times()</span></code></a></li>
<li><a class="reference internal" href="#gtfstk.cleaners.clean_route_short_names" title="gtfstk.cleaners.clean_route_short_names"><code class="xref py py-func docutils literal notranslate"><span class="pre">clean_route_short_names()</span></code></a></li>
<li><a class="reference internal" href="#gtfstk.cleaners.drop_zombies" title="gtfstk.cleaners.drop_zombies"><code class="xref py py-func docutils literal notranslate"><span class="pre">drop_zombies()</span></code></a></li>
</ol>
<p>to the given Feed in that order.
Return the resulting Feed.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.cleaners.clean_column_names">
<code class="descclassname">gtfstk.cleaners.</code><code class="descname">clean_column_names</code><span class="sig-paren">(</span><em>df: pandas.core.frame.DataFrame</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.cleaners.clean_column_names" title="Permalink to this definition">¶</a></dt>
<dd><p>Strip the whitespace from all column names in the given DataFrame
and return the result.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.cleaners.clean_ids">
<code class="descclassname">gtfstk.cleaners.</code><code class="descname">clean_ids</code><span class="sig-paren">(</span><em>feed: Feed</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.cleaners.clean_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>In the given Feed, strip whitespace from all string IDs and
then replace every remaining whitespace chunk with an underscore.
Return the resulting Feed.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.cleaners.clean_route_short_names">
<code class="descclassname">gtfstk.cleaners.</code><code class="descname">clean_route_short_names</code><span class="sig-paren">(</span><em>feed: Feed</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.cleaners.clean_route_short_names" title="Permalink to this definition">¶</a></dt>
<dd><p>In <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code>, assign ‘n/a’ to missing route short names and
strip whitespace from route short names.
Then disambiguate each route short name that is duplicated by
appending ‘-‘ and its route ID.
Return the resulting Feed.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.cleaners.clean_times">
<code class="descclassname">gtfstk.cleaners.</code><code class="descname">clean_times</code><span class="sig-paren">(</span><em>feed: Feed</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.cleaners.clean_times" title="Permalink to this definition">¶</a></dt>
<dd><p>In the given Feed, convert H:MM:SS time strings to HH:MM:SS time
strings to make sorting by time work as expected.
Return the resulting Feed.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.cleaners.drop_invalid_columns">
<code class="descclassname">gtfstk.cleaners.</code><code class="descname">drop_invalid_columns</code><span class="sig-paren">(</span><em>feed: Feed</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.cleaners.drop_invalid_columns" title="Permalink to this definition">¶</a></dt>
<dd><p>Drop all DataFrame columns of the given Feed that are not
listed in the GTFS.
Return the resulting new “Feed”.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.cleaners.drop_zombies">
<code class="descclassname">gtfstk.cleaners.</code><code class="descname">drop_zombies</code><span class="sig-paren">(</span><em>feed: Feed</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.cleaners.drop_zombies" title="Permalink to this definition">¶</a></dt>
<dd><p>In the given Feed, do the following in order:</p>
<ol class="arabic simple">
<li>Drop stops of location type 0 or NaN with no stop times.</li>
<li>Remove undefined parent stations from the <code class="docutils literal notranslate"><span class="pre">parent_station</span></code> column.</li>
<li>Drop trips with no stop times.</li>
<li>Drop shapes with no trips.</li>
<li>Drop routes with no trips.</li>
<li>Drop services with no trips.</li>
</ol>
<p>Return the resulting Feed.</p>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.calendar">
<span id="module-calendar"></span><h2>Module calendar<a class="headerlink" href="#module-gtfstk.calendar" title="Permalink to this headline">¶</a></h2>
<p>Functions about calendar and calendar_dates.</p>
<dl class="function">
<dt id="gtfstk.calendar.get_dates">
<code class="descclassname">gtfstk.calendar.</code><code class="descname">get_dates</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_date_obj: bool = False</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="headerlink" href="#gtfstk.calendar.get_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of dates for which the given “Feed” is valid, which
could be the empty list if the “Feed” has no calendar information.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<em>&quot;Feed&quot;</em>) – </li>
<li><strong>as_date_obj</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then return the dates as <code class="docutils literal notranslate"><span class="pre">datetime.date</span></code> objects;
otherwise return them as strings</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Dates</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.calendar.get_first_week">
<code class="descclassname">gtfstk.calendar.</code><code class="descname">get_first_week</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>as_date_obj: bool = False</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="headerlink" href="#gtfstk.calendar.get_first_week" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of dates for the first Monday–Sunday
week (or initial segment thereof) for which this feed is valid.
If the feed has no Mondays, then return the empty list.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">as_date_obj</span></code>, then return date objects, otherwise return date strings.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.calendar.get_week">
<code class="descclassname">gtfstk.calendar.</code><code class="descname">get_week</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>k: int</em>, <em>*</em>, <em>as_date_obj: bool = False</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="headerlink" href="#gtfstk.calendar.get_week" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a Feed object and a positive integer <code class="docutils literal notranslate"><span class="pre">k</span></code>,
return a list of dates corresponding to the kth Monday–Sunday week
(or initial segment thereof) for which the feed is valid.
For example, k=1 returns the first Monday–Sunday week (or initial segment thereof).
If the feed not have k Mondays, then return the empty list.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">as_date_obj</span></code>, then return date objects, otherwise return date strings.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.calendar.subset_dates">
<code class="descclassname">gtfstk.calendar.</code><code class="descname">subset_dates</code><span class="sig-paren">(</span><em>feed: Feed, dates: List[str]</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="headerlink" href="#gtfstk.calendar.subset_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a “Feed” and a list of dates (YYYYMMDD date strings),
return the sublist of dates that lie in the Feed’s dates
(the output <code class="xref py py-func docutils literal notranslate"><span class="pre">feed.get_dates()</span></code>).</p>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.routes">
<span id="module-routes"></span><h2>Module routes<a class="headerlink" href="#module-gtfstk.routes" title="Permalink to this headline">¶</a></h2>
<p>Functions about routes.</p>
<dl class="function">
<dt id="gtfstk.routes.build_route_timetable">
<code class="descclassname">gtfstk.routes.</code><code class="descname">build_route_timetable</code><span class="sig-paren">(</span><em>feed: Feed, route_id: str, dates: List[str]</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.routes.build_route_timetable" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a timetable for the given route and dates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>route_id</strong> (<em>string</em>) – ID of a route in <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The columns are all those in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code> plus those in
<code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> plus <code class="docutils literal notranslate"><span class="pre">'date'</span></code>, and the trip IDs
are restricted to the given route ID.
The result is sorted first by date and then by grouping by
trip ID and sorting the groups by their first departure time.</p>
<p>Skip dates outside of the Feed’s dates.</p>
<p>If there is no route activity on the given dates, then return
an empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.routes.build_zero_route_time_series">
<code class="descclassname">gtfstk.routes.</code><code class="descname">build_zero_route_time_series</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>date_label: str = '20010101'</em>, <em>freq: str = '5Min'</em>, <em>*</em>, <em>split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.routes.build_zero_route_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a route time series with the same index and hierarchical columns
as output by <a class="reference internal" href="#gtfstk.routes.compute_route_time_series_base" title="gtfstk.routes.compute_route_time_series_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_route_time_series_base()</span></code></a>,
but fill it full of zero values.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.routes.compute_route_stats">
<code class="descclassname">gtfstk.routes.</code><code class="descname">compute_route_stats</code><span class="sig-paren">(</span><em>feed: Feed, trip_stats_subset: pandas.core.frame.DataFrame, dates: List[str], headway_start_time: str = '07:00:00', headway_end_time: str = '19:00:00', *, split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.routes.compute_route_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute route stats for all the trips that lie in the given subset
of trip stats and that start on the given dates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_stats_subset</strong> (<em>DataFrame</em>) – Slice of the output of <a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a></li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate the stats by trip direction (0 or 1);
otherwise aggregate trips visiting from both directions</li>
<li><strong>headway_start_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the start time for computing
headway stats</li>
<li><strong>headway_end_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the end time for computing
headway stats</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'date'</span></code></li>
<li>the columns listed in :func:<code class="docutils literal notranslate"><span class="pre">compute_route_stats_base</span></code></li>
</ul>
<p>Exclude dates with no active stops, which could yield the empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">The route stats for date d contain stats for trips that start on
date d only and ignore trips that start on date d-1 and end on
date d</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li>Those used in <code class="xref py py-func docutils literal notranslate"><span class="pre">helpers.compute_route_stats_base()</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN
direction ID values present</p>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.routes.compute_route_stats_base">
<code class="descclassname">gtfstk.routes.</code><code class="descname">compute_route_stats_base</code><span class="sig-paren">(</span><em>trip_stats_subset: pandas.core.frame.DataFrame</em>, <em>headway_start_time: str = '07:00:00'</em>, <em>headway_end_time: str = '19:00:00'</em>, <em>*</em>, <em>split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.routes.compute_route_stats_base" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute stats for the given subset of trips stats.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>trip_stats_subset</strong> (<em>DataFrame</em>) – Subset of the output of <a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a></li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate the stats by trip direction (0 or 1);
otherwise aggregate trips visiting from both directions</li>
<li><strong>headway_start_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the start time for computing
headway stats</li>
<li><strong>headway_end_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the end time for computing
headway stats</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><em>DataFrame</em> – Columns are<ul>
<li><code class="docutils literal notranslate"><span class="pre">'route_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_short_name'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_type'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trips'</span></code>: number of trips on the route in the subset</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trip_starts'</span></code>: number of trips on the route with
nonnull start times</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trip_ends'</span></code>: number of trips on the route with nonnull
end times that end before 23:59:59</li>
<li><code class="docutils literal notranslate"><span class="pre">'is_loop'</span></code>: 1 if at least one of the trips on the route has
its <code class="docutils literal notranslate"><span class="pre">is_loop</span></code> field equal to 1; 0 otherwise</li>
<li><code class="docutils literal notranslate"><span class="pre">'is_bidirectional'</span></code>: 1 if the route has trips in both
directions; 0 otherwise</li>
<li><code class="docutils literal notranslate"><span class="pre">'start_time'</span></code>: start time of the earliest trip on the route</li>
<li><code class="docutils literal notranslate"><span class="pre">'end_time'</span></code>: end time of latest trip on the route</li>
<li><code class="docutils literal notranslate"><span class="pre">'max_headway'</span></code>: maximum of the durations (in minutes)
between trip starts on the route between
<code class="docutils literal notranslate"><span class="pre">headway_start_time</span></code> and <code class="docutils literal notranslate"><span class="pre">headway_end_time</span></code> on the given
dates</li>
<li><code class="docutils literal notranslate"><span class="pre">'min_headway'</span></code>: minimum of the durations (in minutes)
mentioned above</li>
<li><code class="docutils literal notranslate"><span class="pre">'mean_headway'</span></code>: mean of the durations (in minutes)
mentioned above</li>
<li><code class="docutils literal notranslate"><span class="pre">'peak_num_trips'</span></code>: maximum number of simultaneous trips in
service (for the given direction, or for both directions when
<code class="docutils literal notranslate"><span class="pre">split_directions==False</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">'peak_start_time'</span></code>: start time of first longest period
during which the peak number of trips occurs</li>
<li><code class="docutils literal notranslate"><span class="pre">'peak_end_time'</span></code>: end time of first longest period during
which the peak number of trips occurs</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_duration'</span></code>: total of the duration of each trip on
the route in the given subset of trips; measured in hours</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_distance'</span></code>: total of the distance traveled by each
trip on the route in the given subset of trips; measured in
whatever distance units are present in <code class="docutils literal notranslate"><span class="pre">trip_stats_subset</span></code>;
contains all <code class="docutils literal notranslate"><span class="pre">np.nan</span></code> entries if <code class="docutils literal notranslate"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'service_speed'</span></code>: service_distance/service_duration;
measured in distance units per hour</li>
<li><code class="docutils literal notranslate"><span class="pre">'mean_trip_distance'</span></code>: service_distance/num_trips</li>
<li><code class="docutils literal notranslate"><span class="pre">'mean_trip_duration'</span></code>: service_duration/num_trips</li>
</ul>
</li>
<li>If not <code class="docutils literal notranslate"><span class="pre">split_directions</span></code>, then remove the</li>
<li><em>direction_id column and compute each route’s stats,</em></li>
<li><em>except for headways, using</em></li>
<li><em>its trips running in both directions.</em></li>
<li><em>In this case, (1) compute max headway by taking the max of the</em></li>
<li><em>max headways in both directions; (2) compute mean headway by</em></li>
<li><em>taking the weighted mean of the mean headways in both</em></li>
<li><em>directions.</em></li>
<li>If <code class="docutils literal notranslate"><span class="pre">trip_stats_subset</span></code> is empty, return an empty DataFrame.</li>
<li>Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN</li>
<li><em>direction ID values present</em></li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.routes.compute_route_time_series">
<code class="descclassname">gtfstk.routes.</code><code class="descname">compute_route_time_series</code><span class="sig-paren">(</span><em>feed: Feed, trip_stats_subset: pandas.core.frame.DataFrame, dates: List[str], freq: str = '5Min', *, split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.routes.compute_route_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute route stats in time series form for the trips that lie in
the trip stats subset and that start on the given dates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_stats_subset</strong> (<em>DataFrame</em>) – Slice of the output of <a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a></li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate each routes’s stats by trip direction;
otherwise aggregate trips in both directions</li>
<li><strong>freq</strong> (<em>Pandas frequency string</em>) – Specifices the frequency with which to resample the time series;
max frequency is one minute (‘Min’)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Same format as output by <a class="reference internal" href="#gtfstk.routes.compute_route_time_series_base" title="gtfstk.routes.compute_route_time_series_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_route_time_series_base()</span></code></a>
but with multiple dates</p>
<p>Exclude dates that lie outside of the Feed’s date range.
If all dates lie outside the Feed’s date range, then return an
empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">See the notes for <a class="reference internal" href="#gtfstk.routes.compute_route_time_series_base" title="gtfstk.routes.compute_route_time_series_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_route_time_series_base()</span></code></a></p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN
direction ID values present</p>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.routes.compute_route_time_series_base">
<code class="descclassname">gtfstk.routes.</code><code class="descname">compute_route_time_series_base</code><span class="sig-paren">(</span><em>trip_stats_subset: pandas.core.frame.DataFrame</em>, <em>date_label: str = '20010101'</em>, <em>freq: str = '5Min'</em>, <em>*</em>, <em>split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.routes.compute_route_time_series_base" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute stats in a 24-hour time series form for the given subset of trips.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>trip_stats_subset</strong> (<em>DataFrame</em>) – A subset of the output of <a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a></li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate each routes’s stats by trip direction;
otherwise aggregate trips in both directions</li>
<li><strong>freq</strong> (<em>Pandas frequency string</em>) – Specifices the frequency with which to resample the time series;
max frequency is one minute (‘Min’)</li>
<li><strong>date_label</strong> (<em>string</em>) – YYYYMMDD date string used as the date in the time series index</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>A time series version of the following route stats for each
route.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">num_trips</span></code>: number of trips in service on the route
at any time within the time bin</li>
<li><code class="docutils literal notranslate"><span class="pre">num_trip_starts</span></code>: number of trips that start within
the time bin</li>
<li><code class="docutils literal notranslate"><span class="pre">num_trip_ends</span></code>: number of trips that end within the
time bin, ignoring trips that end past midnight</li>
<li><code class="docutils literal notranslate"><span class="pre">service_distance</span></code>: sum of the service duration accrued
during the time bin across all trips on the route;
measured in hours</li>
<li><code class="docutils literal notranslate"><span class="pre">service_distance</span></code>: sum of the service distance accrued
during the time bin across all trips on the route; measured
in kilometers</li>
<li><code class="docutils literal notranslate"><span class="pre">service_speed</span></code>: <code class="docutils literal notranslate"><span class="pre">service_distance/service_duration</span></code>
for the route</li>
</ul>
<p>The columns are hierarchical (multi-indexed) with</p>
<ul class="simple">
<li>top level: name is <code class="docutils literal notranslate"><span class="pre">'indicator'</span></code>; values are
<code class="docutils literal notranslate"><span class="pre">'num_trip_starts'</span></code>, <code class="docutils literal notranslate"><span class="pre">'num_trip_ends'</span></code>, <code class="docutils literal notranslate"><span class="pre">'num_trips'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'service_distance'</span></code>, <code class="docutils literal notranslate"><span class="pre">'service_duration'</span></code>, and
<code class="docutils literal notranslate"><span class="pre">'service_speed'</span></code></li>
<li>middle level: name is <code class="docutils literal notranslate"><span class="pre">'route_id'</span></code>;
values are the active routes</li>
<li>bottom level: name is <code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code>; values are 0s and 1s</li>
</ul>
<p>If not <code class="docutils literal notranslate"><span class="pre">split_directions</span></code>, then don’t include the bottom level.</p>
<p>The time series has a timestamp index for a 24-hour period
sampled at the given frequency.
The maximum allowable frequency is 1 minute.
If <code class="docutils literal notranslate"><span class="pre">trip_stats_subset</span></code> is empty, then return an empty
DataFrame with the columns <code class="docutils literal notranslate"><span class="pre">'num_trip_starts'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'num_trip_ends'</span></code>, <code class="docutils literal notranslate"><span class="pre">'num_trips'</span></code>, <code class="docutils literal notranslate"><span class="pre">'service_distance'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'service_duration'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'service_speed'</span></code>.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>The time series is computed at a one-minute frequency, then
resampled at the end to the given frequency</li>
<li>Trips that lack start or end times are ignored, so the the
aggregate <code class="docutils literal notranslate"><span class="pre">num_trips</span></code> across the day could be less than the
<code class="docutils literal notranslate"><span class="pre">num_trips</span></code> column of <a class="reference internal" href="#gtfstk.routes.compute_route_stats_base" title="gtfstk.routes.compute_route_stats_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_route_stats_base()</span></code></a></li>
<li>All trip departure times are taken modulo 24 hours.
So routes with trips that end past 23:59:59 will have all
their stats wrap around to the early morning of the time series,
except for their <code class="docutils literal notranslate"><span class="pre">num_trip_ends</span></code> indicator.
Trip endings past 23:59:59 not binned so that resampling the
<code class="docutils literal notranslate"><span class="pre">num_trips</span></code> indicator works efficiently.</li>
<li>Note that the total number of trips for two consecutive time bins
t1 &lt; t2 is the sum of the number of trips in bin t2 plus the
number of trip endings in bin t1.
Thus we can downsample the <code class="docutils literal notranslate"><span class="pre">num_trips</span></code> indicator by keeping
track of only one extra count, <code class="docutils literal notranslate"><span class="pre">num_trip_ends</span></code>, and can avoid
recording individual trip IDs.</li>
<li>All other indicators are downsampled by summing.</li>
<li>Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN
direction ID values present</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.routes.get_routes">
<code class="descclassname">gtfstk.routes.</code><code class="descname">get_routes</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>date: Optional[str] = None</em>, <em>time: Optional[str] = None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.routes.get_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a subset of <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string restricting routes to only those active on
the date</li>
<li><strong>time</strong> (<em>string</em>) – HH:MM:SS time string, possibly with HH &gt; 23, restricting routes
to only those active during the time</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A subset of <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a>.</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.routes.map_routes">
<code class="descclassname">gtfstk.routes.</code><code class="descname">map_routes</code><span class="sig-paren">(</span><em>feed: Feed, route_ids: List[str], date: Optional[str] = None, color_palette: List[str] = ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f', '#e5c494', '#b3b3b3'], *, include_stops: bool = True</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.routes.map_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Folium map showing the given routes and (optionally)
their stops.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>route_ids</strong> (<em>list</em>) – IDs of routes in <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string restricting the output to trips active
on the date</li>
<li><strong>color_palette</strong> (<em>list</em>) – Palette to use to color the routes. If more routes than colors,
then colors will be recycled.</li>
<li><strong>include_stops</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then include stops in the map</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A Folium Map depicting the distinct shapes of the trips on
each route.
If <code class="docutils literal notranslate"><span class="pre">include_stops</span></code>, then include the stops for each route.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>Requires Folium</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.routes.route_to_geojson">
<code class="descclassname">gtfstk.routes.</code><code class="descname">route_to_geojson</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>route_id: str</em>, <em>date: Optional[str] = None</em>, <em>*</em>, <em>include_stops: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#gtfstk.routes.route_to_geojson" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a GeoJSON rendering of the route and, optionally, its stops.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>route_id</strong> (<em>string</em>) – ID of a route in <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string restricting the output to trips active
on the date</li>
<li><strong>include_stops</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then include stop features in the result</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A decoded GeoJSON feature collection comprising a
LineString features of the distinct shapes of the trips on the
route.
If <code class="docutils literal notranslate"><span class="pre">include_stops</span></code>, then include one Point feature for
each stop on the route.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.shapes">
<span id="module-shapes"></span><h2>Module shapes<a class="headerlink" href="#module-gtfstk.shapes" title="Permalink to this headline">¶</a></h2>
<p>Functions about shapes.</p>
<dl class="function">
<dt id="gtfstk.shapes.append_dist_to_shapes">
<code class="descclassname">gtfstk.shapes.</code><code class="descname">append_dist_to_shapes</code><span class="sig-paren">(</span><em>feed: Feed</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.shapes.append_dist_to_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate and append the optional <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> field in
<code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code> in terms of the distance units <code class="docutils literal notranslate"><span class="pre">feed.dist_units</span></code>.
Return the resulting Feed.</p>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">As a benchmark, using this function on <a class="reference external" href="https://transitfeeds.com/p/trimet/43/1400947517">this Portland feed</a>
produces a <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> column that differs by at most
0.016 km in absolute value from of the original values</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.shapes.build_geometry_by_shape">
<code class="descclassname">gtfstk.shapes.</code><code class="descname">build_geometry_by_shape</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>shape_ids: Optional[List[str]] = None</em>, <em>*</em>, <em>use_utm: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#gtfstk.shapes.build_geometry_by_shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary with structure shape_id -&gt; Shapely LineString
of shape.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>shape_ids</strong> (<em>list</em>) – IDs of shapes in <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code> to restrict output to; return
all shapes if <code class="docutils literal notranslate"><span class="pre">None</span></code>.</li>
<li><strong>use_utm</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then use local UTM coordinates; otherwise, use
WGS84 coordinates</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Has the structure
shape_id -&gt; Shapely LineString of shape.
If <code class="docutils literal notranslate"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code>, then return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>Return the empty dictionary if <code class="docutils literal notranslate"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code>.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.shapes.geometrize_shapes">
<code class="descclassname">gtfstk.shapes.</code><code class="descname">geometrize_shapes</code><span class="sig-paren">(</span><em>shapes: pandas.core.frame.DataFrame</em>, <em>*</em>, <em>use_utm: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.shapes.geometrize_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a GTFS shapes DataFrame, convert it to a GeoPandas
GeoDataFrame and return the result.
The result has a <code class="docutils literal notranslate"><span class="pre">'geometry'</span></code> column of WGS84 LineStrings
instead of the columns <code class="docutils literal notranslate"><span class="pre">'shape_pt_sequence'</span></code>, <code class="docutils literal notranslate"><span class="pre">'shape_pt_lon'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'shape_pt_lat'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'shape_dist_traveled'</span></code>.
If <code class="docutils literal notranslate"><span class="pre">use_utm</span></code>, then use local UTM coordinates for the geometries.</p>
<p class="rubric">Notes</p>
<p>Requires GeoPandas.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.shapes.get_shapes_intersecting_geometry">
<code class="descclassname">gtfstk.shapes.</code><code class="descname">get_shapes_intersecting_geometry</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>geometry</em>, <em>geo_shapes=None</em>, <em>*</em>, <em>geometrized: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.shapes.get_shapes_intersecting_geometry" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the slice of <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code> that contains all shapes that
intersect the given Shapely geometry, e.g. a Polygon or LineString.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>geometry</strong> (<em>Shapley geometry</em><em>, </em><em>e.g. a Polygon</em>) – Specified in WGS84 coordinates</li>
<li><strong>geo_shapes</strong> (<em>GeoPandas GeoDataFrame</em>) – The output of <a class="reference internal" href="#gtfstk.shapes.geometrize_shapes" title="gtfstk.shapes.geometrize_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">geometrize_shapes()</span></code></a></li>
<li><strong>geometrize</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then return the shapes DataFrame as a GeoDataFrame
of the form output by <a class="reference internal" href="#gtfstk.shapes.geometrize_shapes" title="gtfstk.shapes.geometrize_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">geometrize_shapes()</span></code></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame or GeoDataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">Requires GeoPandas</p>
</li>
<li><p class="first">Specifying <code class="docutils literal notranslate"><span class="pre">geo_shapes</span></code> will skip the first step of the
algorithm, namely, geometrizing <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code></p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code>, if <code class="docutils literal notranslate"><span class="pre">geo_shapes</span></code> is not given</li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.shapes.shapes_to_geojson">
<code class="descclassname">gtfstk.shapes.</code><code class="descname">shapes_to_geojson</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>shape_ids: Optional[List[str]] = None</em><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#gtfstk.shapes.shapes_to_geojson" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a (decoded) GeoJSON FeatureCollection of LineString features
representing <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code>.
Each feature will have a <code class="docutils literal notranslate"><span class="pre">shape_id</span></code> property.
The coordinates reference system is the default one for GeoJSON,
namely WGS84.</p>
<p>If a list of shape IDs is given, then return only the LineString
features corresponding to those shape IDS.
Return the empty dictionary if <code class="docutils literal notranslate"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code></p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.shapes.ungeometrize_shapes">
<code class="descclassname">gtfstk.shapes.</code><code class="descname">ungeometrize_shapes</code><span class="sig-paren">(</span><em>geo_shapes</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.shapes.ungeometrize_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>The inverse of <a class="reference internal" href="#gtfstk.shapes.geometrize_shapes" title="gtfstk.shapes.geometrize_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">geometrize_shapes()</span></code></a>.
Produces the columns:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'shape_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'shape_pt_sequence'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'shape_pt_lon'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'shape_pt_lat'</span></code></li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">geo_shapes</span></code> is in UTM coordinates (has a UTM CRS property),
then convert thoes UTM coordinates back to WGS84 coordinates,
which is the standard for a GTFS shapes table.</p>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.stop_times">
<span id="module-stop-times"></span><h2>Module stop_times<a class="headerlink" href="#module-gtfstk.stop_times" title="Permalink to this headline">¶</a></h2>
<p>Functions about stop times.</p>
<dl class="function">
<dt id="gtfstk.stop_times.append_dist_to_stop_times">
<code class="descclassname">gtfstk.stop_times.</code><code class="descname">append_dist_to_stop_times</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>trip_stats: pandas.core.frame.DataFrame</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.stop_times.append_dist_to_stop_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate and append the optional <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> field in
<code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> in terms of the distance units
<code class="docutils literal notranslate"><span class="pre">feed.dist_units</span></code>.
Need trip stats in the form output by
<a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a> for this.
Return the resulting Feed.</p>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">Does not always give accurate results, as described below.</p>
</li>
<li><p class="first">The algorithm works as follows.
Compute the <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> field by using Shapely to
measure the distance of a stop along its trip linestring.
If for a given trip this process produces a non-monotonically
increasing, hence incorrect, list of (cumulative) distances, then
fall back to estimating the distances as follows.</p>
<p>Get the average speed of the trip via <code class="docutils literal notranslate"><span class="pre">trip_stats</span></code> and use is to
linearly interpolate distances for stop times, assuming that the
first stop is at shape_dist_traveled = 0 (the start of the shape)
and the last stop is at shape_dist_traveled = the length of the trip
(taken from trip_stats and equal to the length of the shape, unless
<code class="docutils literal notranslate"><span class="pre">trip_stats</span></code> was called with <code class="docutils literal notranslate"><span class="pre">get_dist_from_shapes</span> <span class="pre">==</span> <span class="pre">False</span></code>).
This fallback method usually kicks in on trips with
self-intersecting linestrings.
Unfortunately, this fallback method will produce incorrect results
when the first stop does not start at the start of its shape
(so shape_dist_traveled != 0).
This is the case for several trips in <a class="reference external" href="https://transitfeeds.com/p/trimet/43/1400947517">this Portland feed</a>, for example.</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.shapes.build_geometry_by_shape" title="gtfstk.shapes.build_geometry_by_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">shapes.build_geometry_by_shape()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stops.build_geometry_by_stop" title="gtfstk.stops.build_geometry_by_stop"><code class="xref py py-func docutils literal notranslate"><span class="pre">stops.build_geometry_by_stop()</span></code></a></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stop_times.get_start_and_end_times">
<code class="descclassname">gtfstk.stop_times.</code><code class="descname">get_start_and_end_times</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>date: Optional[str] = None</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="headerlink" href="#gtfstk.stop_times.get_start_and_end_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the first departure time and last arrival time
(HH:MM:SS time strings) listed in <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code>, respectively.
Restrict to the given date (YYYYMMDD string) if specified.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stop_times.get_stop_times">
<code class="descclassname">gtfstk.stop_times.</code><code class="descname">get_stop_times</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>date: Optional[str] = None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stop_times.get_stop_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a subset of <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string restricting the output to trips active
on the date</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Subset of <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
</ul>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.stops">
<span id="module-stops"></span><h2>Module stops<a class="headerlink" href="#module-gtfstk.stops" title="Permalink to this headline">¶</a></h2>
<p>Functions about stops.</p>
<dl class="data">
<dt id="gtfstk.stops.STOP_STYLE">
<code class="descclassname">gtfstk.stops.</code><code class="descname">STOP_STYLE</code><em class="property"> = {'color': '#fc8d62', 'fill': True, 'fill_opacity': 0.75, 'radius': 8, 'weight': 1}</em><a class="headerlink" href="#gtfstk.stops.STOP_STYLE" title="Permalink to this definition">¶</a></dt>
<dd><p>Folium CircleMarker parameters for mapping stops</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.build_geometry_by_stop">
<code class="descclassname">gtfstk.stops.</code><code class="descname">build_geometry_by_stop</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>stop_ids: Optional[List[str]] = None</em>, <em>*</em>, <em>use_utm: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#gtfstk.stops.build_geometry_by_stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary with the structure
stop_id -&gt; Shapely Point with coordinates of the stop.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>use_utm</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then return each point in UTM coordinates
appropriate to the region; otherwise use the default WGS84
coordinates</li>
<li><strong>stop_ids</strong> (<em>list</em>) – Stop IDs (strings) from <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code> to restrict output to</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Each key is a stop ID and each value is a Shapely Point with
coordinates of the stop</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.build_stop_timetable">
<code class="descclassname">gtfstk.stops.</code><code class="descname">build_stop_timetable</code><span class="sig-paren">(</span><em>feed: Feed, stop_id: str, dates: List[str]</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stops.build_stop_timetable" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame containing the timetable for the given stop ID
and dates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>stop_id</strong> (<em>string</em>) – ID of the stop for which to build the timetable</li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The columns are all those in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code> plus those in
<code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> plus <code class="docutils literal notranslate"><span class="pre">'date'</span></code>, and the stop IDs are
restricted to the given stop ID.
The result is sorted by date then departure time.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stop_times.get_stop_times" title="gtfstk.stop_times.get_stop_times"><code class="xref py py-func docutils literal notranslate"><span class="pre">stop_times.get_stop_times()</span></code></a></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.build_zero_stop_time_series">
<code class="descclassname">gtfstk.stops.</code><code class="descname">build_zero_stop_time_series</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>date_label: str = '20010101'</em>, <em>freq: str = '5Min'</em>, <em>*</em>, <em>split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stops.build_zero_stop_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a stop time series with the same index and hierarchical columns
as output by <a class="reference internal" href="#gtfstk.stops.compute_stop_time_series_base" title="gtfstk.stops.compute_stop_time_series_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_stop_time_series_base()</span></code></a>,
but fill it full of zero values.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.compute_stop_activity">
<code class="descclassname">gtfstk.stops.</code><code class="descname">compute_stop_activity</code><span class="sig-paren">(</span><em>feed: Feed, dates: List[str]</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stops.compute_stop_activity" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark stops as active or inactive on the given dates.
A stop is <em>active</em> on a given date if some trips that starts on the
date visits the stop (possibly after midnight).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute activity</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are</p>
<ul class="simple">
<li>stop_id</li>
<li><code class="docutils literal notranslate"><span class="pre">dates[0]</span></code>: 1 if the stop has at least one trip visiting it
on <code class="docutils literal notranslate"><span class="pre">dates[0]</span></code>; 0 otherwise</li>
<li><code class="docutils literal notranslate"><span class="pre">dates[1]</span></code>: 1 if the stop has at least one trip visiting it
on <code class="docutils literal notranslate"><span class="pre">dates[1]</span></code>; 0 otherwise</li>
<li>etc.</li>
<li><code class="docutils literal notranslate"><span class="pre">dates[-1]</span></code>: 1 if the stop has at least one trip visiting it
on <code class="docutils literal notranslate"><span class="pre">dates[-1]</span></code>; 0 otherwise</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">If all dates lie outside the Feed period, then return an empty
DataFrame</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.compute_trip_activity" title="gtfstk.trips.compute_trip_activity"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_activity()</span></code></a></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.compute_stop_stats">
<code class="descclassname">gtfstk.stops.</code><code class="descname">compute_stop_stats</code><span class="sig-paren">(</span><em>feed: Feed, dates: List[str], stop_ids: Optional[List[str]] = None, headway_start_time: str = '07:00:00', headway_end_time: str = '19:00:00', *, split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stops.compute_stop_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute stats for all stops for the given dates.
Optionally, restrict to the stop IDs given.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>stop_ids</strong> (<em>list</em>) – Optional list of stop IDs to restrict stats to</li>
<li><strong>headway_start_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the start time for computing
headway stats</li>
<li><strong>headway_end_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the end time for computing
headway stats</li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate the stop stats by direction (0 or 1)
of the trips visiting the stops; otherwise aggregate trips
visiting from both directions</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'date'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'stop_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code>: present if and only if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'num_routes'</span></code>: number of routes visiting the stop
(in the given direction) on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trips'</span></code>: number of trips visiting stop
(in the givin direction) on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'max_headway'</span></code>: maximum of the durations (in minutes)
between trip departures at the stop between
<code class="docutils literal notranslate"><span class="pre">headway_start_time</span></code> and <code class="docutils literal notranslate"><span class="pre">headway_end_time</span></code> on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'min_headway'</span></code>: minimum of the durations (in minutes) mentioned
above</li>
<li><code class="docutils literal notranslate"><span class="pre">'mean_headway'</span></code>: mean of the durations (in minutes) mentioned
above</li>
<li><code class="docutils literal notranslate"><span class="pre">'start_time'</span></code>: earliest departure time of a trip from this stop
on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'end_time'</span></code>: latest departure time of a trip from this stop on
the date</li>
</ul>
<p>Exclude dates with no active stops, which could yield the empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
</ul>
</dd>
</dl>
</li>
<li>Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN
direction ID values present</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.compute_stop_stats_base">
<code class="descclassname">gtfstk.stops.</code><code class="descname">compute_stop_stats_base</code><span class="sig-paren">(</span><em>stop_times_subset: pandas.core.frame.DataFrame</em>, <em>trip_subset: pandas.core.frame.DataFrame</em>, <em>headway_start_time: str = '07:00:00'</em>, <em>headway_end_time: str = '19:00:00'</em>, <em>*</em>, <em>split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stops.compute_stop_stats_base" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a subset of a stop times DataFrame and a subset of a trips
DataFrame, return a DataFrame that provides summary stats about the
stops in the inner join of the two DataFrames.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stop_times_subset</strong> (<em>DataFrame</em>) – A valid GTFS stop times table</li>
<li><strong>trip_subset</strong> (<em>DataFrame</em>) – A valid GTFS trips table</li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate the stop stats by direction (0 or 1)
of the trips visiting the stops; otherwise aggregate trips
visiting from both directions</li>
<li><strong>headway_start_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the start time for computing
headway stats</li>
<li><strong>headway_end_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the end time for computing
headway stats</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The columns are</p>
<ul class="simple">
<li>stop_id</li>
<li>direction_id: present if and only if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code></li>
<li>num_routes: number of routes visiting stop
(in the given direction)</li>
<li>num_trips: number of trips visiting stop
(in the givin direction)</li>
<li>max_headway: maximum of the durations (in minutes)
between trip departures at the stop between
<code class="docutils literal notranslate"><span class="pre">headway_start_time</span></code> and <code class="docutils literal notranslate"><span class="pre">headway_end_time</span></code></li>
<li>min_headway: minimum of the durations (in minutes) mentioned
above</li>
<li>mean_headway: mean of the durations (in minutes) mentioned
above</li>
<li>start_time: earliest departure time of a trip from this stop</li>
<li>end_time: latest departure time of a trip from this stop</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>If <code class="docutils literal notranslate"><span class="pre">trip_subset</span></code> is empty, then return an empty DataFrame.</li>
<li>Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN
direction ID values present.</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.compute_stop_time_series">
<code class="descclassname">gtfstk.stops.</code><code class="descname">compute_stop_time_series</code><span class="sig-paren">(</span><em>feed: Feed, dates: List[str], stop_ids: Optional[List[str]] = None, freq: str = '5Min', *, split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stops.compute_stop_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute time series for the stops on the given dates at the
given frequency and return the result as a DataFrame of the same
form as output by <code class="xref py py-func docutils literal notranslate"><span class="pre">stop_times.compute_stop_time_series_base()</span></code>.
Optionally restrict to stops in the given list of stop IDs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>stop_ids</strong> (<em>list</em>) – Optional list of stop IDs to restrict to</li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate the stop stats by direction (0 or 1)
of the trips visiting the stops; otherwise aggregate trips
visiting from both directions</li>
<li><strong>freq</strong> (<em>Pandas frequency string</em>) – Specifices the frequency with which to resample the time series;
max frequency is one minute (‘Min’)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>A time series with a timestamp index across the given dates
sampled at the given frequency.
The maximum allowable frequency is 1 minute.</p>
<p>The columns are the same as in
<a class="reference internal" href="#gtfstk.stops.compute_stop_time_series_base" title="gtfstk.stops.compute_stop_time_series_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_stop_time_series_base()</span></code></a>.</p>
<p>Exclude dates that lie outside of the Feed’s date range.
If all dates lie outside the Feed’s date range, then return an
empty DataFrame</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">See the notes for <a class="reference internal" href="#gtfstk.stops.compute_stop_time_series_base" title="gtfstk.stops.compute_stop_time_series_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_stop_time_series_base()</span></code></a></p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN
direction ID values present</p>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.compute_stop_time_series_base">
<code class="descclassname">gtfstk.stops.</code><code class="descname">compute_stop_time_series_base</code><span class="sig-paren">(</span><em>stop_times_subset: pandas.core.frame.DataFrame</em>, <em>trip_subset: pandas.core.frame.DataFrame</em>, <em>freq: str = '5Min'</em>, <em>date_label: str = '20010101'</em>, <em>*</em>, <em>split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stops.compute_stop_time_series_base" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a subset of a stop times DataFrame and a subset of a trips
DataFrame, return a DataFrame that provides a summary time series
about the stops in the inner join of the two DataFrames.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stop_times_subset</strong> (<em>DataFrame</em>) – A valid GTFS stop times table</li>
<li><strong>trip_subset</strong> (<em>DataFrame</em>) – A valid GTFS trips table</li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate each stop’s stats by trip direction;
otherwise aggregate trips visiting from both directions</li>
<li><strong>freq</strong> (<em>Pandas frequency string</em>) – Specifices the frequency with which to resample the time series;
max frequency is one minute (‘Min’)</li>
<li><strong>date_label</strong> (<em>string</em>) – YYYYMMDD date string used as the date in the time series index</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>A time series with a timestamp index for a 24-hour period
sampled at the given frequency.
The only indicator variable for each stop is</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">num_trips</span></code>: the number of trips that visit the stop and
have a nonnull departure time from the stop</li>
</ul>
<p>The maximum allowable frequency is 1 minute.</p>
<p>The columns are hierarchical (multi-indexed) with</p>
<ul class="simple">
<li>top level: name = ‘indicator’, values = [‘num_trips’]</li>
<li>middle level: name = ‘stop_id’, values = the active stop IDs</li>
<li>bottom level: name = ‘direction_id’, values = 0s and 1s</li>
</ul>
<p>If not <code class="docutils literal notranslate"><span class="pre">split_directions</span></code>, then don’t include the bottom level.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>The time series is computed at a one-minute frequency, then
resampled at the end to the given frequency</li>
<li>Stop times with null departure times are ignored, so the aggregate
of <code class="docutils literal notranslate"><span class="pre">num_trips</span></code> across the day could be less than the
<code class="docutils literal notranslate"><span class="pre">num_trips</span></code> column in <a class="reference internal" href="#gtfstk.stops.compute_stop_stats_base" title="gtfstk.stops.compute_stop_stats_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_stop_stats_base()</span></code></a></li>
<li>All trip departure times are taken modulo 24 hours,
so routes with trips that end past 23:59:59 will have all
their stats wrap around to the early morning of the time series.</li>
<li>‘num_trips’ should be resampled with <code class="docutils literal notranslate"><span class="pre">how=np.sum</span></code></li>
<li>If <code class="docutils literal notranslate"><span class="pre">trip_subset</span></code> is empty, then return an empty DataFrame</li>
<li>Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN
direction ID values present</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.geometrize_stops">
<code class="descclassname">gtfstk.stops.</code><code class="descname">geometrize_stops</code><span class="sig-paren">(</span><em>stops: List[str], *, use_utm: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stops.geometrize_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a stops DataFrame, convert it to a GeoPandas GeoDataFrame
and return the result.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stops</strong> (<em>DataFrame</em>) – A GTFS stops table</li>
<li><strong>use_utm</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then convert the output to local UTM coordinates;
otherwise use WGS84 coordinates</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Looks like the given stops DataFrame, but has a <code class="docutils literal notranslate"><span class="pre">'geometry'</span></code>
column of Shapely Point objects that replaces
the <code class="docutils literal notranslate"><span class="pre">'stop_lon'</span></code> and <code class="docutils literal notranslate"><span class="pre">'stop_lat'</span></code> columns.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">GeoPandas GeoDataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Requires GeoPandas.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.get_stops">
<code class="descclassname">gtfstk.stops.</code><code class="descname">get_stops</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>date: Optional[str] = None</em>, <em>trip_id: Optional[str] = None</em>, <em>route_id: Optional[str] = None</em>, <em>*</em>, <em>in_stations: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stops.get_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a section of <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD string; restricts the output to stops active
(visited by trips) on the date</li>
<li><strong>trip_id</strong> (<em>string</em>) – ID of a trip in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code>; restricts output to stops
visited by the trip</li>
<li><strong>route_id</strong> (<em>string</em>) – ID of route in <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code>; restricts output to stops
visited by the route</li>
<li><strong>in_stations</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then restricts output to stops in stations if
station data is available in <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A subset of <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code> defined by the parameters above</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stop_times.get_stop_times" title="gtfstk.stop_times.get_stop_times"><code class="xref py py-func docutils literal notranslate"><span class="pre">stop_times.get_stop_times()</span></code></a></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.get_stops_in_polygon">
<code class="descclassname">gtfstk.stops.</code><code class="descname">get_stops_in_polygon</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>polygon: shapely.geometry.polygon.Polygon</em>, <em>geo_stops=None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stops.get_stops_in_polygon" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the slice of <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code> that contains all stops that lie
within the given Shapely Polygon object that is specified in
WGS84 coordinates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>polygon</strong> (<em>Shapely Polygon</em>) – Specified in WGS84 coordinates</li>
<li><strong>geo_stops</strong> (<em>Geopandas GeoDataFrame</em>) – A geographic version of <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code> which will be computed
if not given.
Specify this parameter in batch jobs to avoid unnecessary
computation.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Subset of <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">Requires GeoPandas</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stops</span></code>, if <code class="docutils literal notranslate"><span class="pre">geo_stops</span></code> is not given</li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.map_stops">
<code class="descclassname">gtfstk.stops.</code><code class="descname">map_stops</code><span class="sig-paren">(</span><em>feed: Feed, stop_ids: List[str], stop_style: Dict = {'color': '#fc8d62', 'fill': True, 'fill_opacity': 0.75, 'radius': 8, 'weight': 1}</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.stops.map_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Folium map showing the given stops.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>stop_ids</strong> (<em>list</em>) – IDs of trips in <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
<li><strong>stop_style</strong> (<em>dictionary</em>) – Folium CircleMarker parameters to use for styling stops.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A Folium Map depicting the stops as CircleMarkers.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>Requires Folium</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.stops.ungeometrize_stops">
<code class="descclassname">gtfstk.stops.</code><code class="descname">ungeometrize_stops</code><span class="sig-paren">(</span><em>geo_stops: pandas.core.frame.DataFrame</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.stops.ungeometrize_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>The inverse of <a class="reference internal" href="#gtfstk.stops.geometrize_stops" title="gtfstk.stops.geometrize_stops"><code class="xref py py-func docutils literal notranslate"><span class="pre">geometrize_stops()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>geo_stops</strong> (<em>GeoPandas GeoDataFrame</em>) – Looks like a GTFS stops table, but has a <code class="docutils literal notranslate"><span class="pre">'geometry'</span></code> column
of Shapely Point objects that replaces the
<code class="docutils literal notranslate"><span class="pre">'stop_lon'</span></code> and <code class="docutils literal notranslate"><span class="pre">'stop_lat'</span></code> columns.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A GTFS stops table where the <code class="docutils literal notranslate"><span class="pre">'stop_lon'</span></code> and <code class="docutils literal notranslate"><span class="pre">'stop_lat'</span></code>
columns are derived from the points in the given GeoDataFrame
and are in WGS84 coordinates regardless of the coordinate
reference system of the given GeoDataFrame.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">DataFrame</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.trips">
<span id="module-trips"></span><h2>Module trips<a class="headerlink" href="#module-gtfstk.trips" title="Permalink to this headline">¶</a></h2>
<p>Functions about trips.</p>
<dl class="function">
<dt id="gtfstk.trips.compute_busiest_date">
<code class="descclassname">gtfstk.trips.</code><code class="descname">compute_busiest_date</code><span class="sig-paren">(</span><em>feed: Feed, dates: List[str]</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#gtfstk.trips.compute_busiest_date" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of dates, return the first date that has the
maximum number of active trips.</p>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.trips.compute_trip_activity" title="gtfstk.trips.compute_trip_activity"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_trip_activity()</span></code></a></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.trips.compute_trip_activity">
<code class="descclassname">gtfstk.trips.</code><code class="descname">compute_trip_activity</code><span class="sig-paren">(</span><em>feed: Feed, dates: List[str]</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.trips.compute_trip_activity" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark trip as active or inactive on the given dates as computed
by <a class="reference internal" href="#gtfstk.trips.is_active_trip" title="gtfstk.trips.is_active_trip"><code class="xref py py-func docutils literal notranslate"><span class="pre">is_active_trip()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute activity</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'trip_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">dates[0]</span></code>: 1 if the trip is active on <code class="docutils literal notranslate"><span class="pre">dates[0]</span></code>;
0 otherwise</li>
<li><code class="docutils literal notranslate"><span class="pre">dates[1]</span></code>: 1 if the trip is active on <code class="docutils literal notranslate"><span class="pre">dates[1]</span></code>;
0 otherwise</li>
<li>etc.</li>
<li><code class="docutils literal notranslate"><span class="pre">dates[-1]</span></code>: 1 if the trip is active on <code class="docutils literal notranslate"><span class="pre">dates[-1]</span></code>;
0 otherwise</li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">dates</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code> or the empty list, then return an
empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.is_active_trip" title="gtfstk.trips.is_active_trip"><code class="xref py py-func docutils literal notranslate"><span class="pre">is_active_trip()</span></code></a></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.trips.compute_trip_stats">
<code class="descclassname">gtfstk.trips.</code><code class="descname">compute_trip_stats</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>route_ids: Optional[List[str]] = None</em>, <em>*</em>, <em>compute_dist_from_shapes: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.trips.compute_trip_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame with the following columns:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'trip_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_short_name'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_type'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code>: NaN if missing from feed</li>
<li><code class="docutils literal notranslate"><span class="pre">'shape_id'</span></code>: NaN if missing from feed</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_stops'</span></code>: number of stops on trip</li>
<li><code class="docutils literal notranslate"><span class="pre">'start_time'</span></code>: first departure time of the trip</li>
<li><code class="docutils literal notranslate"><span class="pre">'end_time'</span></code>: last departure time of the trip</li>
<li><code class="docutils literal notranslate"><span class="pre">'start_stop_id'</span></code>: stop ID of the first stop of the trip</li>
<li><code class="docutils literal notranslate"><span class="pre">'end_stop_id'</span></code>: stop ID of the last stop of the trip</li>
<li><code class="docutils literal notranslate"><span class="pre">'is_loop'</span></code>: 1 if the start and end stop are less than 400m apart and
0 otherwise</li>
<li><code class="docutils literal notranslate"><span class="pre">'distance'</span></code>: distance of the trip in <code class="docutils literal notranslate"><span class="pre">feed.dist_units</span></code>;
contains all <code class="docutils literal notranslate"><span class="pre">np.nan</span></code> entries if <code class="docutils literal notranslate"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'duration'</span></code>: duration of the trip in hours</li>
<li><code class="docutils literal notranslate"><span class="pre">'speed'</span></code>: distance/duration</li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> has a <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> column with at
least one non-NaN value and <code class="docutils literal notranslate"><span class="pre">compute_dist_from_shapes</span> <span class="pre">==</span> <span class="pre">False</span></code>,
then use that column to compute the distance column.
Else if <code class="docutils literal notranslate"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></code>, then compute the distance
column using the shapes and Shapely.
Otherwise, set the distances to NaN.</p>
<p>If route IDs are given, then restrict to trips on those routes.</p>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code> (optionally)</li>
<li>Those used in <a class="reference internal" href="#gtfstk.stops.build_geometry_by_stop" title="gtfstk.stops.build_geometry_by_stop"><code class="xref py py-func docutils literal notranslate"><span class="pre">stops.build_geometry_by_stop()</span></code></a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Calculating trip distances with <code class="docutils literal notranslate"><span class="pre">compute_dist_from_shapes=True</span></code>
seems pretty accurate.  For example, calculating trip distances on
<a class="reference external" href="https://transitfeeds.com/p/trimet/43/1400947517">this Portland feed</a>
using <code class="docutils literal notranslate"><span class="pre">compute_dist_from_shapes=False</span></code> and
<code class="docutils literal notranslate"><span class="pre">compute_dist_from_shapes=True</span></code>,
yields a difference of at most 0.83km from the original values.</p>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.trips.get_trips">
<code class="descclassname">gtfstk.trips.</code><code class="descname">get_trips</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>date: Optional[str] = None</em>, <em>time: Optional[str] = None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.trips.get_trips" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a subset of <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string</li>
<li><strong>time</strong> (<em>string</em>) – HH:MM:SS time string, possibly with HH &gt; 23</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The subset of <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code> containing trips active (starting)
on the given date at the given time.
If no date or time are specified, then return the entire
<code class="docutils literal notranslate"><span class="pre">feed.trips</span></code>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.trips.is_active_trip">
<code class="descclassname">gtfstk.trips.</code><code class="descname">is_active_trip</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>trip_id: str</em>, <em>date: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.trips.is_active_trip" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the <code class="docutils literal notranslate"><span class="pre">feed.calendar</span></code> or <code class="docutils literal notranslate"><span class="pre">feed.calendar_dates</span></code>
says that the trip runs on the given date; return <code class="docutils literal notranslate"><span class="pre">False</span></code>
otherwise.</p>
<p>Note that a trip that starts on date d, ends after 23:59:59, and
does not start again on date d+1 is considered active on date d and
not active on date d+1.
This subtle point, which is a side effect of the GTFS, can
lead to confusion.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_id</strong> (<em>string</em>) – ID of a trip in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><code class="docutils literal notranslate"><span class="pre">True</span></code> if and only if the given trip starts on the given
date.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">boolean</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">This function is key for getting all trips, routes, etc. that are
active on a given date, so the function needs to be fast</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.trips.locate_trips">
<code class="descclassname">gtfstk.trips.</code><code class="descname">locate_trips</code><span class="sig-paren">(</span><em>feed: Feed, date: str, times: List[str]</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.trips.locate_trips" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the positions of all trips active on the
given date and times</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string</li>
<li><strong>times</strong> (<em>list</em>) – HH:MM:SS time strings, possibly with HH &gt; 23</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'trip_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code>: all NaNs if <code class="docutils literal notranslate"><span class="pre">feed.trips.direction_id</span></code> is
missing</li>
<li><code class="docutils literal notranslate"><span class="pre">'time'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'rel_dist'</span></code>: number between 0 (start) and 1 (end)
indicating the relative distance of the trip along its path</li>
<li><code class="docutils literal notranslate"><span class="pre">'lon'</span></code>: longitude of trip at given time</li>
<li><code class="docutils literal notranslate"><span class="pre">'lat'</span></code>: latitude of trip at given time</li>
</ul>
<p>Assume <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> has an accurate
<code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> column.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stop_times.get_stop_times" title="gtfstk.stop_times.get_stop_times"><code class="xref py py-func docutils literal notranslate"><span class="pre">stop_times.get_stop_times()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.shapes.build_geometry_by_shape" title="gtfstk.shapes.build_geometry_by_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">shapes.build_geometry_by_shape()</span></code></a></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.trips.map_trips">
<code class="descclassname">gtfstk.trips.</code><code class="descname">map_trips</code><span class="sig-paren">(</span><em>feed: Feed, trip_ids: List[str], color_palette: List[str] = ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f', '#e5c494', '#b3b3b3'], *, include_stops: bool = True</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.trips.map_trips" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Folium map showing the given trips and (optionally)
their stops.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_ids</strong> (<em>list</em>) – IDs of trips in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><strong>color_palette</strong> (<em>list</em>) – Palette to use to color the routes. If more routes than colors,
then colors will be recycled.</li>
<li><strong>include_stops</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then include stops in the map</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A Folium Map depicting the shapes of the trips.
If <code class="docutils literal notranslate"><span class="pre">include_stops</span></code>, then include the stops for each trip.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>Requires Folium</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.trips.trip_to_geojson">
<code class="descclassname">gtfstk.trips.</code><code class="descname">trip_to_geojson</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>trip_id: str</em>, <em>*</em>, <em>include_stops: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#gtfstk.trips.trip_to_geojson" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a GeoJSON representation of the given trip, optionally with
its stops.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_id</strong> (<em>string</em>) – ID of trip in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><strong>include_stops</strong> (<em>boolean</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>A (decoded) GeoJSON FeatureCollection comprising a Linestring
feature representing the trip’s shape.
If <code class="docutils literal notranslate"><span class="pre">include_stops</span></code>, then also include one Point feature for
each stop  visited by the trip.
The Linestring feature will contain as properties all the
columns in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code> pertaining to the given trip,
and each Point feature will contain as properties all the
columns in <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code> pertaining to the stop,
except the <code class="docutils literal notranslate"><span class="pre">stop_lat</span></code> and <code class="docutils literal notranslate"><span class="pre">stop_lon</span></code> properties.</p>
<p>Return the empty dictionary if the trip has no shape.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.miscellany">
<span id="module-miscellany"></span><h2>Module miscellany<a class="headerlink" href="#module-gtfstk.miscellany" title="Permalink to this headline">¶</a></h2>
<p>Functions about miscellany.</p>
<dl class="function">
<dt id="gtfstk.miscellany.assess_quality">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">assess_quality</code><span class="sig-paren">(</span><em>feed: Feed</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.miscellany.assess_quality" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame of various feed indicators and values,
e.g. number of trips missing shapes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">The columns are<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'indicator'</span></code>: string; name of an indicator, e.g. ‘num_routes’</li>
<li><code class="docutils literal notranslate"><span class="pre">'value'</span></code>: value of the indicator, e.g. 27</li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">DataFrame</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>An odd function, but useful to see roughly how broken a feed is</li>
<li>Not a GTFS validator</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.compute_bounds">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">compute_bounds</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.miscellany.compute_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the tuple (min longitude, min latitude, max longitude,
max latitude) where the longitudes and latitude vary across all
the Feed’s stop coordinates.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.compute_center">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">compute_center</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.miscellany.compute_center" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the <code class="docutils literal notranslate"><span class="pre">num_busiest_stops</span></code> (integer) most scheduled stops from <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code>,
and return the mean of the longitudes and the mean of the latitudes of these stops,
respectively, a kind of center of the feed.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.compute_convex_hull">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">compute_convex_hull</code><span class="sig-paren">(</span><em>feed: Feed</em><span class="sig-paren">)</span> &#x2192; shapely.geometry.polygon.Polygon<a class="headerlink" href="#gtfstk.miscellany.compute_convex_hull" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Shapely Polygon representing the convex hull formed by
the stops of the given Feed.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.compute_feed_stats">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">compute_feed_stats</code><span class="sig-paren">(</span><em>feed: Feed, trip_stats: pandas.core.frame.DataFrame, dates: List[str], *, split_route_types=False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.miscellany.compute_feed_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute some feed stats for the given dates and trip stats.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_stats</strong> (<em>DataFrame</em>) – Trip stats to consider in the format output by
<a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a></li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>split_route_types</strong> (<em>boolean</em>) – If True then split stats by route type; otherwise don’t</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'date'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_type'</span></code> (optional): presest if and only if <code class="docutils literal notranslate"><span class="pre">split_route_types</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'num_stops'</span></code>: number of stops active on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_routes'</span></code>: number of routes active on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trips'</span></code>: number of trips that start on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trip_starts'</span></code>: number of trips with nonnull start
times on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trip_ends'</span></code>: number of trips with nonnull start times
and nonnull end times on the date, ignoring trips that end
after 23:59:59 on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'peak_num_trips'</span></code>: maximum number of simultaneous trips in
service on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'peak_start_time'</span></code>: start time of first longest period
during which the peak number of trips occurs on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'peak_end_time'</span></code>: end time of first longest period during
which the peak number of trips occurs on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_distance'</span></code>: sum of the service distances for the
active routes on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_duration'</span></code>: sum of the service durations for the
active routes on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_speed'</span></code>: service_distance/service_duration on the
date</li>
</ul>
<p>Exclude dates with no active stops, which could yield the empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">The route and trip stats for date d contain stats for trips that
start on date d only and ignore trips that start on date d-1 and
end on date d</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.routes.get_routes" title="gtfstk.routes.get_routes"><code class="xref py py-func docutils literal notranslate"><span class="pre">routes.get_routes()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stops.get_stops" title="gtfstk.stops.get_stops"><code class="xref py py-func docutils literal notranslate"><span class="pre">stops.get_stops()</span></code></a></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.compute_feed_stats_base">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">compute_feed_stats_base</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>trip_stats_subset: pandas.core.frame.DataFrame</em>, <em>*</em>, <em>split_route_types=False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.miscellany.compute_feed_stats_base" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.compute_feed_time_series">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">compute_feed_time_series</code><span class="sig-paren">(</span><em>feed: Feed, trip_stats: pandas.core.frame.DataFrame, dates: List[str], freq: str = '5Min', *, split_route_types: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.miscellany.compute_feed_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute some feed stats in time series form for the given dates
and trip stats.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_stats</strong> (<em>DataFrame</em>) – Trip stats to consider in the format output by
<a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a></li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>freq</strong> (<em>string</em>) – Pandas frequency string specifying the frequency of the
resulting time series, e.g. ‘5Min’; highest frequency allowable
is one minute (‘Min’).</li>
<li><strong>split_route_types</strong> (<em>boolean</em>) – If True then split stats by route type; otherwise don’t</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>A time series with a datetime index across the given dates sampled
at the given frequency across the given dates.
The maximum allowable frequency is 1 minute.</p>
<p>The columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'num_trips'</span></code>: number of trips in service during during the
time period</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trip_starts'</span></code>: number of trips with starting during the
time period</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trip_ends'</span></code>: number of trips ending during the
time period, ignoring the trips the end past midnight</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_distance'</span></code>: distance traveled during the time
period by all trips active during the time period</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_duration'</span></code>: duration traveled during the time
period by all trips active during the time period</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_speed'</span></code>: <code class="docutils literal notranslate"><span class="pre">service_distance/service_duration</span></code></li>
</ul>
<p>Exclude dates that lie outside of the Feed’s date range.
If all the dates given lie outside of the Feed’s date range,
then return an empty DataFrame with the specified columns.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">split_route_types</span></code>, then multi-index the columns with</p>
<ul class="simple">
<li>top level: name is <code class="docutils literal notranslate"><span class="pre">'indicator'</span></code>; values are
<code class="docutils literal notranslate"><span class="pre">'num_trip_starts'</span></code>, <code class="docutils literal notranslate"><span class="pre">'num_trip_ends'</span></code>, <code class="docutils literal notranslate"><span class="pre">'num_trips'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'service_distance'</span></code>, <code class="docutils literal notranslate"><span class="pre">'service_duration'</span></code>, and
<code class="docutils literal notranslate"><span class="pre">'service_speed'</span></code></li>
<li>bottom level: name is <code class="docutils literal notranslate"><span class="pre">'route_type'</span></code>; values are route type values</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">See the notes for <a class="reference internal" href="#gtfstk.routes.compute_route_time_series_base" title="gtfstk.routes.compute_route_time_series_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">routes.compute_route_time_series_base()</span></code></a></p>
</li>
<li><p class="first">If all dates lie outside the Feed’s date range, then return an
empty DataFrame</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.routes.compute_route_time_series" title="gtfstk.routes.compute_route_time_series"><code class="xref py py-func docutils literal notranslate"><span class="pre">routes.compute_route_time_series()</span></code></a></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.compute_screen_line_counts">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">compute_screen_line_counts</code><span class="sig-paren">(</span><em>feed: Feed, linestring: shapely.geometry.linestring.LineString, dates: List[str], geo_shapes=None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.miscellany.compute_screen_line_counts" title="Permalink to this definition">¶</a></dt>
<dd><p>Find all the Feed trips active on the given dates
that intersect the given Shapely LineString (with WGS84
longitude-latitude coordinates).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>linestring</strong> (<em>Shapely LineString</em>) – </li>
<li><strong>dates</strong> (<em>list</em>) – YYYYMMDD date strings</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'date'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'trip_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_short_name'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'crossing_time'</span></code>: time that the trip’s vehicle crosses
the linestring; one trip could cross multiple times</li>
<li><code class="docutils literal notranslate"><span class="pre">'orientation'</span></code>: 1 or -1; 1 indicates trip travel from the
left side to the right side of the screen line;
-1 indicates trip travel in the  opposite direction</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">Requires GeoPandas</p>
</li>
<li><p class="first">The first step is to geometrize <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code> via
<a class="reference internal" href="#gtfstk.shapes.geometrize_shapes" title="gtfstk.shapes.geometrize_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">shapes.geometrize_shapes()</span></code></a>. Alternatively, use the
<code class="docutils literal notranslate"><span class="pre">geo_shapes</span></code> GeoDataFrame, if given.</p>
</li>
<li><p class="first">Assume <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> has an accurate
<code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> column.</p>
</li>
<li><p class="first">Assume that trips travel in the same direction as their
shapes. That restriction is part of GTFS, by the way.
To calculate direction quickly and accurately, assume that
the screen line is straight and doesn’t double back on itself.</p>
</li>
<li><p class="first">Probably does not give correct results for trips with
self-intersecting shapes.</p>
</li>
<li><p class="first">The algorithm works as follows</p>
<blockquote>
<div><ol class="arabic simple">
<li>Compute all the shapes that intersect the linestring</li>
<li>For each such shape, compute the intersection points</li>
<li>For each point p, scan through all the trips in the feed
that have that shape</li>
<li>For each date in <code class="docutils literal notranslate"><span class="pre">dates</span></code>, restrict to trips active on the
date and interpolate a stop time for p by assuming that the
feed has the shape_dist_traveled field in stop times</li>
<li>Use that interpolated time as the crossing time of the trip
vehicle, and compute the trip orientation to the screen line
via a cross product of a vector in the direction of the
screen line and a tiny vector in the direction of trip travel</li>
</ol>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code>, if <code class="docutils literal notranslate"><span class="pre">geo_shapes</span></code> is not given</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.convert_dist">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">convert_dist</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>new_dist_units: str</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.miscellany.convert_dist" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the distances recorded in the <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code>
columns of the given Feed to the given distance units.
New distance units must lie in <code class="xref py py-const docutils literal notranslate"><span class="pre">constants.DIST_UNITS</span></code>.
Return the resulting feed.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.create_shapes">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">create_shapes</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>*</em>, <em>all_trips: bool = False</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.miscellany.create_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a feed, create a shape for every trip that is missing a
shape ID.
Do this by connecting the stops on the trip with straight lines.
Return the resulting feed which has updated shapes and trips
tables.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">all_trips</span></code>, then create new shapes for all trips by
connecting stops, and remove the old shapes.</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.describe">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">describe</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>sample_date: Optional[str] = None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.miscellany.describe" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame of various feed indicators and values,
e.g. number of routes.
Specialize some those indicators to the given sample date,
e.g. number of routes active on the date.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>sample_date</strong> (<em>string</em>) – YYYYMMDD date string specifying the date to compute sample
stats; defaults to the first Thursday of the Feed’s period</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'indicator'</span></code>: string; name of an indicator, e.g. ‘num_routes’</li>
<li><code class="docutils literal notranslate"><span class="pre">'value'</span></code>: value of the indicator, e.g. 27</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.restrict_to_dates">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">restrict_to_dates</code><span class="sig-paren">(</span><em>feed: Feed, dates: List[str]</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.miscellany.restrict_to_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a new feed by restricting this one to only the stops,
trips, shapes, etc. active on at least one of the given dates
(YYYYMMDD strings).
Return the resulting feed, which will have empty non-agency tables
if no trip is active on any of the given dates.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.restrict_to_polygon">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">restrict_to_polygon</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>polygon: shapely.geometry.polygon.Polygon</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.miscellany.restrict_to_polygon" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a new feed by restricting this one to only the trips
that have at least one stop intersecting the given Shapely polygon,
then restricting stops, routes, stop times, etc. to those
associated with that subset of trips.
Return the resulting feed.</p>
<p>Requires GeoPandas.</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stops.get_stops_in_polygon" title="gtfstk.stops.get_stops_in_polygon"><code class="xref py py-func docutils literal notranslate"><span class="pre">stops.get_stops_in_polygon()</span></code></a></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.restrict_to_routes">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">restrict_to_routes</code><span class="sig-paren">(</span><em>feed: Feed, route_ids: List[str]</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.miscellany.restrict_to_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a new feed by restricting this one to only the stops,
trips, shapes, etc. used by the routes with the given list of
route IDs.
Return the resulting feed.</p>
</dd></dl>

<dl class="function">
<dt id="gtfstk.miscellany.summarize">
<code class="descclassname">gtfstk.miscellany.</code><code class="descname">summarize</code><span class="sig-paren">(</span><em>feed: Feed</em>, <em>table: str = None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.miscellany.summarize" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame summarizing all GTFS tables in the given feed
or in the given table if specified.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>table</strong> (<em>string</em>) – A GTFS table name, e.g. <code class="docutils literal notranslate"><span class="pre">'stop_times'</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'table'</span></code>: name of the GTFS table, e.g. <code class="docutils literal notranslate"><span class="pre">'stops'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'column'</span></code>: name of a column in the table,
e.g. <code class="docutils literal notranslate"><span class="pre">'stop_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'num_values'</span></code>: number of values in the column</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_nonnull_values'</span></code>: number of nonnull values in the
column</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_unique_values'</span></code>: number of unique values in the
column, excluding null values</li>
<li><code class="docutils literal notranslate"><span class="pre">'min_value'</span></code>: minimum value in the column</li>
<li><code class="docutils literal notranslate"><span class="pre">'max_value'</span></code>: maximum value in the column</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>If the table is not in the feed, then return an empty DataFrame</li>
<li>If the table is not valid, raise a ValueError</li>
</ul>
</dd></dl>

</div>
<div class="section" id="module-gtfstk.feed">
<span id="module-feed"></span><h2>Module feed<a class="headerlink" href="#module-gtfstk.feed" title="Permalink to this headline">¶</a></h2>
<p>This module defines a Feed class to represent GTFS feeds.
There is an instance attribute for every GTFS table (routes, stops, etc.),
which stores the table as a Pandas DataFrame,
or as <code class="docutils literal notranslate"><span class="pre">None</span></code> in case that table is missing.</p>
<p>The Feed class also has heaps of methods: a method to compute route stats,
a method to compute screen line counts, validations methods, etc.
To ease reading, almost all of these methods are defined in other modules and
grouped by theme (<code class="docutils literal notranslate"><span class="pre">routes.py</span></code>, <code class="docutils literal notranslate"><span class="pre">stops.py</span></code>, etc.).
These methods, or rather functions that operate on feeds, are
then imported within the Feed class.
This separation of methods unfortunately messes up slightly the <code class="docutils literal notranslate"><span class="pre">Feed</span></code> class
documentation generated by Sphinx, introducing an extra leading <code class="docutils literal notranslate"><span class="pre">feed</span></code>
parameter in the method signatures.
Ignore that extra parameter; it refers to the Feed instance,
usually called <code class="docutils literal notranslate"><span class="pre">self</span></code> and usually hidden automatically by Sphinx.</p>
<dl class="class">
<dt id="gtfstk.feed.Feed">
<em class="property">class </em><code class="descclassname">gtfstk.feed.</code><code class="descname">Feed</code><span class="sig-paren">(</span><em>dist_units: str</em>, <em>agency: Optional[pandas.core.frame.DataFrame] = None</em>, <em>stops: Optional[pandas.core.frame.DataFrame] = None</em>, <em>routes: Optional[pandas.core.frame.DataFrame] = None</em>, <em>trips: Optional[pandas.core.frame.DataFrame] = None</em>, <em>stop_times: Optional[pandas.core.frame.DataFrame] = None</em>, <em>calendar: Optional[pandas.core.frame.DataFrame] = None</em>, <em>calendar_dates: Optional[pandas.core.frame.DataFrame] = None</em>, <em>fare_attributes: Optional[pandas.core.frame.DataFrame] = None</em>, <em>fare_rules: Optional[pandas.core.frame.DataFrame] = None</em>, <em>shapes: Optional[pandas.core.frame.DataFrame] = None</em>, <em>frequencies: Optional[pandas.core.frame.DataFrame] = None</em>, <em>transfers: Optional[pandas.core.frame.DataFrame] = None</em>, <em>feed_info: Optional[pandas.core.frame.DataFrame] = None</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>An instance of this class represents a not-necessarily-valid GTFS feed,
where GTFS tables are stored as DataFrames.
Beware that the stop times DataFrame can be big (several gigabytes),
so make sure you have enough memory to handle it.</p>
<p>Primary instance attributes:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">dist_units</span></code>: a string in <code class="xref py py-const docutils literal notranslate"><span class="pre">constants.DIST_UNITS</span></code>;
specifies the distance units to use when calculating various
stats, such as route service distance; should match the implicit
distance units of the <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> column values,
if present</li>
<li><code class="docutils literal notranslate"><span class="pre">agency</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">stops</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">routes</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">trips</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">stop_times</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">calendar</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">calendar_dates</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">fare_attributes</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">fare_rules</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">shapes</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">frequencies</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">transfers</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed_info</span></code></li>
</ul>
<p>There are also a few secondary instance attributes that are derived
from the primary attributes and are automatically updated when the
primary attributes change.
However, for this update to work, you must update the primary
attributes like this (good):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="p">[</span><span class="s1">&#39;route_short_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bingo&#39;</span>
<span class="n">feed</span><span class="o">.</span><span class="n">trips</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">trips</span>
</pre></div>
</div>
<p>and <strong>not</strong> like this (bad):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="p">[</span><span class="s1">&#39;route_short_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bingo&#39;</span>
</pre></div>
</div>
<p>The first way ensures that the altered trips DataFrame is saved as
the new <code class="docutils literal notranslate"><span class="pre">trips</span></code> attribute, but the second way does not.</p>
<dl class="method">
<dt id="gtfstk.feed.Feed.aggregate_routes">
<code class="descname">aggregate_routes</code><span class="sig-paren">(</span><em>by: str = 'route_short_name'</em>, <em>route_id_prefix: str = 'route_'</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.aggregate_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregate routes by route short name, say, and assign new route IDs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<em>&quot;Feed&quot;</em>) – </li>
<li><strong>by</strong> (<em>string</em>) – A column of <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li><strong>route_id_prefix</strong> (<em>string</em>) – Prefix to use when creating new route IDs</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The result is built from the given Feed as follows.
Group <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code> by the <code class="docutils literal notranslate"><span class="pre">by</span></code> column, and for each group</p>
<ol class="arabic simple">
<li>Choose the first route in the group</li>
<li>Assign a new route ID based on the given <code class="docutils literal notranslate"><span class="pre">route_id_prefix</span></code>
string and a running count, e.g. <code class="docutils literal notranslate"><span class="pre">'route_013'</span></code></li>
<li>Assign all the trips associated with routes in the group to
that first route</li>
<li>Update the route IDs in the other “Feed” tables</li>
</ol>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">“Feed”</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.append_dist_to_shapes">
<code class="descname">append_dist_to_shapes</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.append_dist_to_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate and append the optional <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> field in
<code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code> in terms of the distance units <code class="docutils literal notranslate"><span class="pre">feed.dist_units</span></code>.
Return the resulting Feed.</p>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">As a benchmark, using this function on <a class="reference external" href="https://transitfeeds.com/p/trimet/43/1400947517">this Portland feed</a>
produces a <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> column that differs by at most
0.016 km in absolute value from of the original values</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.append_dist_to_stop_times">
<code class="descname">append_dist_to_stop_times</code><span class="sig-paren">(</span><em>trip_stats: pandas.core.frame.DataFrame</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.append_dist_to_stop_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate and append the optional <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> field in
<code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> in terms of the distance units
<code class="docutils literal notranslate"><span class="pre">feed.dist_units</span></code>.
Need trip stats in the form output by
<a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a> for this.
Return the resulting Feed.</p>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">Does not always give accurate results, as described below.</p>
</li>
<li><p class="first">The algorithm works as follows.
Compute the <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> field by using Shapely to
measure the distance of a stop along its trip linestring.
If for a given trip this process produces a non-monotonically
increasing, hence incorrect, list of (cumulative) distances, then
fall back to estimating the distances as follows.</p>
<p>Get the average speed of the trip via <code class="docutils literal notranslate"><span class="pre">trip_stats</span></code> and use is to
linearly interpolate distances for stop times, assuming that the
first stop is at shape_dist_traveled = 0 (the start of the shape)
and the last stop is at shape_dist_traveled = the length of the trip
(taken from trip_stats and equal to the length of the shape, unless
<code class="docutils literal notranslate"><span class="pre">trip_stats</span></code> was called with <code class="docutils literal notranslate"><span class="pre">get_dist_from_shapes</span> <span class="pre">==</span> <span class="pre">False</span></code>).
This fallback method usually kicks in on trips with
self-intersecting linestrings.
Unfortunately, this fallback method will produce incorrect results
when the first stop does not start at the start of its shape
(so shape_dist_traveled != 0).
This is the case for several trips in <a class="reference external" href="https://transitfeeds.com/p/trimet/43/1400947517">this Portland feed</a>, for example.</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.shapes.build_geometry_by_shape" title="gtfstk.shapes.build_geometry_by_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">shapes.build_geometry_by_shape()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stops.build_geometry_by_stop" title="gtfstk.stops.build_geometry_by_stop"><code class="xref py py-func docutils literal notranslate"><span class="pre">stops.build_geometry_by_stop()</span></code></a></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.assess_quality">
<code class="descname">assess_quality</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.assess_quality" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame of various feed indicators and values,
e.g. number of trips missing shapes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">The columns are<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'indicator'</span></code>: string; name of an indicator, e.g. ‘num_routes’</li>
<li><code class="docutils literal notranslate"><span class="pre">'value'</span></code>: value of the indicator, e.g. 27</li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">DataFrame</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>An odd function, but useful to see roughly how broken a feed is</li>
<li>Not a GTFS validator</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.build_geometry_by_shape">
<code class="descname">build_geometry_by_shape</code><span class="sig-paren">(</span><em>shape_ids: Optional[List[str]] = None</em>, <em>*</em>, <em>use_utm: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#gtfstk.feed.Feed.build_geometry_by_shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary with structure shape_id -&gt; Shapely LineString
of shape.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>shape_ids</strong> (<em>list</em>) – IDs of shapes in <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code> to restrict output to; return
all shapes if <code class="docutils literal notranslate"><span class="pre">None</span></code>.</li>
<li><strong>use_utm</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then use local UTM coordinates; otherwise, use
WGS84 coordinates</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Has the structure
shape_id -&gt; Shapely LineString of shape.
If <code class="docutils literal notranslate"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code>, then return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>Return the empty dictionary if <code class="docutils literal notranslate"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code>.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.build_geometry_by_stop">
<code class="descname">build_geometry_by_stop</code><span class="sig-paren">(</span><em>stop_ids: Optional[List[str]] = None</em>, <em>*</em>, <em>use_utm: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#gtfstk.feed.Feed.build_geometry_by_stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary with the structure
stop_id -&gt; Shapely Point with coordinates of the stop.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>use_utm</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then return each point in UTM coordinates
appropriate to the region; otherwise use the default WGS84
coordinates</li>
<li><strong>stop_ids</strong> (<em>list</em>) – Stop IDs (strings) from <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code> to restrict output to</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Each key is a stop ID and each value is a Shapely Point with
coordinates of the stop</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.build_route_timetable">
<code class="descname">build_route_timetable</code><span class="sig-paren">(</span><em>route_id: str, dates: List[str]</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.build_route_timetable" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a timetable for the given route and dates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>route_id</strong> (<em>string</em>) – ID of a route in <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The columns are all those in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code> plus those in
<code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> plus <code class="docutils literal notranslate"><span class="pre">'date'</span></code>, and the trip IDs
are restricted to the given route ID.
The result is sorted first by date and then by grouping by
trip ID and sorting the groups by their first departure time.</p>
<p>Skip dates outside of the Feed’s dates.</p>
<p>If there is no route activity on the given dates, then return
an empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.build_stop_timetable">
<code class="descname">build_stop_timetable</code><span class="sig-paren">(</span><em>stop_id: str, dates: List[str]</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.build_stop_timetable" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame containing the timetable for the given stop ID
and dates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>stop_id</strong> (<em>string</em>) – ID of the stop for which to build the timetable</li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The columns are all those in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code> plus those in
<code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> plus <code class="docutils literal notranslate"><span class="pre">'date'</span></code>, and the stop IDs are
restricted to the given stop ID.
The result is sorted by date then departure time.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stop_times.get_stop_times" title="gtfstk.stop_times.get_stop_times"><code class="xref py py-func docutils literal notranslate"><span class="pre">stop_times.get_stop_times()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.build_zero_route_time_series">
<code class="descname">build_zero_route_time_series</code><span class="sig-paren">(</span><em>date_label: str = '20010101'</em>, <em>freq: str = '5Min'</em>, <em>*</em>, <em>split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.build_zero_route_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a route time series with the same index and hierarchical columns
as output by <code class="xref py py-func docutils literal notranslate"><span class="pre">compute_route_time_series_base()</span></code>,
but fill it full of zero values.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.build_zero_stop_time_series">
<code class="descname">build_zero_stop_time_series</code><span class="sig-paren">(</span><em>date_label: str = '20010101'</em>, <em>freq: str = '5Min'</em>, <em>*</em>, <em>split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.build_zero_stop_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a stop time series with the same index and hierarchical columns
as output by <code class="xref py py-func docutils literal notranslate"><span class="pre">compute_stop_time_series_base()</span></code>,
but fill it full of zero values.</p>
</dd></dl>

<dl class="attribute">
<dt id="gtfstk.feed.Feed.calendar">
<code class="descname">calendar</code><a class="headerlink" href="#gtfstk.feed.Feed.calendar" title="Permalink to this definition">¶</a></dt>
<dd><p>The calendar table of this Feed.</p>
</dd></dl>

<dl class="attribute">
<dt id="gtfstk.feed.Feed.calendar_dates">
<code class="descname">calendar_dates</code><a class="headerlink" href="#gtfstk.feed.Feed.calendar_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>The calendar_dates table of this Feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_agency">
<code class="descname">check_agency</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_agency" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that <code class="docutils literal notranslate"><span class="pre">feed.agency</span></code> follows the GTFS.
Return a list of problems of the form described in
<code class="xref py py-func docutils literal notranslate"><span class="pre">check_table()</span></code>;
the list will be empty if no problems are found.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_calendar">
<code class="descname">check_calendar</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_calendar" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.calendar</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_calendar_dates">
<code class="descname">check_calendar_dates</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_calendar_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.calendar_dates</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_fare_attributes">
<code class="descname">check_fare_attributes</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_fare_attributes" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.calendar_dates</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_fare_rules">
<code class="descname">check_fare_rules</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_fare_rules" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.calendar_dates</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_feed_info">
<code class="descname">check_feed_info</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_feed_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.feed_info</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_frequencies">
<code class="descname">check_frequencies</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_frequencies" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.frequencies</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_routes">
<code class="descname">check_routes</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_shapes">
<code class="descname">check_shapes</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_stop_times">
<code class="descname">check_stop_times</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_stop_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_stops">
<code class="descname">check_stops</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_transfers">
<code class="descname">check_transfers</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_transfers" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.transfers</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.check_trips">
<code class="descname">check_trips</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = False</em>, <em>include_warnings: bool = False</em><span class="sig-paren">)</span> &#x2192; List<a class="headerlink" href="#gtfstk.feed.Feed.check_trips" title="Permalink to this definition">¶</a></dt>
<dd><p>Analog of <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.clean">
<code class="descname">clean</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.clean" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#gtfstk.feed.Feed.clean_ids" title="gtfstk.feed.Feed.clean_ids"><code class="xref py py-func docutils literal notranslate"><span class="pre">clean_ids()</span></code></a></li>
<li><a class="reference internal" href="#gtfstk.feed.Feed.clean_times" title="gtfstk.feed.Feed.clean_times"><code class="xref py py-func docutils literal notranslate"><span class="pre">clean_times()</span></code></a></li>
<li><a class="reference internal" href="#gtfstk.feed.Feed.clean_route_short_names" title="gtfstk.feed.Feed.clean_route_short_names"><code class="xref py py-func docutils literal notranslate"><span class="pre">clean_route_short_names()</span></code></a></li>
<li><a class="reference internal" href="#gtfstk.feed.Feed.drop_zombies" title="gtfstk.feed.Feed.drop_zombies"><code class="xref py py-func docutils literal notranslate"><span class="pre">drop_zombies()</span></code></a></li>
</ol>
<p>to the given Feed in that order.
Return the resulting Feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.clean_ids">
<code class="descname">clean_ids</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.clean_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>In the given Feed, strip whitespace from all string IDs and
then replace every remaining whitespace chunk with an underscore.
Return the resulting Feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.clean_route_short_names">
<code class="descname">clean_route_short_names</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.clean_route_short_names" title="Permalink to this definition">¶</a></dt>
<dd><p>In <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code>, assign ‘n/a’ to missing route short names and
strip whitespace from route short names.
Then disambiguate each route short name that is duplicated by
appending ‘-‘ and its route ID.
Return the resulting Feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.clean_times">
<code class="descname">clean_times</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.clean_times" title="Permalink to this definition">¶</a></dt>
<dd><p>In the given Feed, convert H:MM:SS time strings to HH:MM:SS time
strings to make sorting by time work as expected.
Return the resulting Feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_bounds">
<code class="descname">compute_bounds</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the tuple (min longitude, min latitude, max longitude,
max latitude) where the longitudes and latitude vary across all
the Feed’s stop coordinates.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_busiest_date">
<code class="descname">compute_busiest_date</code><span class="sig-paren">(</span><em>dates: List[str]</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#gtfstk.feed.Feed.compute_busiest_date" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of dates, return the first date that has the
maximum number of active trips.</p>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.compute_trip_activity" title="gtfstk.feed.Feed.compute_trip_activity"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_trip_activity()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_center">
<code class="descname">compute_center</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.compute_center" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the <code class="docutils literal notranslate"><span class="pre">num_busiest_stops</span></code> (integer) most scheduled stops from <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code>,
and return the mean of the longitudes and the mean of the latitudes of these stops,
respectively, a kind of center of the feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_feed_stats">
<code class="descname">compute_feed_stats</code><span class="sig-paren">(</span><em>trip_stats: pandas.core.frame.DataFrame, dates: List[str], *, split_route_types=False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.compute_feed_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute some feed stats for the given dates and trip stats.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_stats</strong> (<em>DataFrame</em>) – Trip stats to consider in the format output by
<a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a></li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>split_route_types</strong> (<em>boolean</em>) – If True then split stats by route type; otherwise don’t</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'date'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_type'</span></code> (optional): presest if and only if <code class="docutils literal notranslate"><span class="pre">split_route_types</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'num_stops'</span></code>: number of stops active on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_routes'</span></code>: number of routes active on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trips'</span></code>: number of trips that start on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trip_starts'</span></code>: number of trips with nonnull start
times on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trip_ends'</span></code>: number of trips with nonnull start times
and nonnull end times on the date, ignoring trips that end
after 23:59:59 on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'peak_num_trips'</span></code>: maximum number of simultaneous trips in
service on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'peak_start_time'</span></code>: start time of first longest period
during which the peak number of trips occurs on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'peak_end_time'</span></code>: end time of first longest period during
which the peak number of trips occurs on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_distance'</span></code>: sum of the service distances for the
active routes on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_duration'</span></code>: sum of the service durations for the
active routes on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_speed'</span></code>: service_distance/service_duration on the
date</li>
</ul>
<p>Exclude dates with no active stops, which could yield the empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">The route and trip stats for date d contain stats for trips that
start on date d only and ignore trips that start on date d-1 and
end on date d</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.routes.get_routes" title="gtfstk.routes.get_routes"><code class="xref py py-func docutils literal notranslate"><span class="pre">routes.get_routes()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stops.get_stops" title="gtfstk.stops.get_stops"><code class="xref py py-func docutils literal notranslate"><span class="pre">stops.get_stops()</span></code></a></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_feed_time_series">
<code class="descname">compute_feed_time_series</code><span class="sig-paren">(</span><em>trip_stats: pandas.core.frame.DataFrame, dates: List[str], freq: str = '5Min', *, split_route_types: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.compute_feed_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute some feed stats in time series form for the given dates
and trip stats.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_stats</strong> (<em>DataFrame</em>) – Trip stats to consider in the format output by
<a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a></li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>freq</strong> (<em>string</em>) – Pandas frequency string specifying the frequency of the
resulting time series, e.g. ‘5Min’; highest frequency allowable
is one minute (‘Min’).</li>
<li><strong>split_route_types</strong> (<em>boolean</em>) – If True then split stats by route type; otherwise don’t</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>A time series with a datetime index across the given dates sampled
at the given frequency across the given dates.
The maximum allowable frequency is 1 minute.</p>
<p>The columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'num_trips'</span></code>: number of trips in service during during the
time period</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trip_starts'</span></code>: number of trips with starting during the
time period</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trip_ends'</span></code>: number of trips ending during the
time period, ignoring the trips the end past midnight</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_distance'</span></code>: distance traveled during the time
period by all trips active during the time period</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_duration'</span></code>: duration traveled during the time
period by all trips active during the time period</li>
<li><code class="docutils literal notranslate"><span class="pre">'service_speed'</span></code>: <code class="docutils literal notranslate"><span class="pre">service_distance/service_duration</span></code></li>
</ul>
<p>Exclude dates that lie outside of the Feed’s date range.
If all the dates given lie outside of the Feed’s date range,
then return an empty DataFrame with the specified columns.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">split_route_types</span></code>, then multi-index the columns with</p>
<ul class="simple">
<li>top level: name is <code class="docutils literal notranslate"><span class="pre">'indicator'</span></code>; values are
<code class="docutils literal notranslate"><span class="pre">'num_trip_starts'</span></code>, <code class="docutils literal notranslate"><span class="pre">'num_trip_ends'</span></code>, <code class="docutils literal notranslate"><span class="pre">'num_trips'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'service_distance'</span></code>, <code class="docutils literal notranslate"><span class="pre">'service_duration'</span></code>, and
<code class="docutils literal notranslate"><span class="pre">'service_speed'</span></code></li>
<li>bottom level: name is <code class="docutils literal notranslate"><span class="pre">'route_type'</span></code>; values are route type values</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">See the notes for <a class="reference internal" href="#gtfstk.routes.compute_route_time_series_base" title="gtfstk.routes.compute_route_time_series_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">routes.compute_route_time_series_base()</span></code></a></p>
</li>
<li><p class="first">If all dates lie outside the Feed’s date range, then return an
empty DataFrame</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.routes.compute_route_time_series" title="gtfstk.routes.compute_route_time_series"><code class="xref py py-func docutils literal notranslate"><span class="pre">routes.compute_route_time_series()</span></code></a></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_route_stats">
<code class="descname">compute_route_stats</code><span class="sig-paren">(</span><em>trip_stats_subset: pandas.core.frame.DataFrame, dates: List[str], headway_start_time: str = '07:00:00', headway_end_time: str = '19:00:00', *, split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.compute_route_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute route stats for all the trips that lie in the given subset
of trip stats and that start on the given dates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_stats_subset</strong> (<em>DataFrame</em>) – Slice of the output of <a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a></li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate the stats by trip direction (0 or 1);
otherwise aggregate trips visiting from both directions</li>
<li><strong>headway_start_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the start time for computing
headway stats</li>
<li><strong>headway_end_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the end time for computing
headway stats</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'date'</span></code></li>
<li>the columns listed in :func:<code class="docutils literal notranslate"><span class="pre">compute_route_stats_base</span></code></li>
</ul>
<p>Exclude dates with no active stops, which could yield the empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">The route stats for date d contain stats for trips that start on
date d only and ignore trips that start on date d-1 and end on
date d</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li>Those used in <code class="xref py py-func docutils literal notranslate"><span class="pre">helpers.compute_route_stats_base()</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN
direction ID values present</p>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_route_time_series">
<code class="descname">compute_route_time_series</code><span class="sig-paren">(</span><em>trip_stats_subset: pandas.core.frame.DataFrame, dates: List[str], freq: str = '5Min', *, split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.compute_route_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute route stats in time series form for the trips that lie in
the trip stats subset and that start on the given dates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_stats_subset</strong> (<em>DataFrame</em>) – Slice of the output of <a class="reference internal" href="#gtfstk.trips.compute_trip_stats" title="gtfstk.trips.compute_trip_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_stats()</span></code></a></li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate each routes’s stats by trip direction;
otherwise aggregate trips in both directions</li>
<li><strong>freq</strong> (<em>Pandas frequency string</em>) – Specifices the frequency with which to resample the time series;
max frequency is one minute (‘Min’)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Same format as output by <code class="xref py py-func docutils literal notranslate"><span class="pre">compute_route_time_series_base()</span></code>
but with multiple dates</p>
<p>Exclude dates that lie outside of the Feed’s date range.
If all dates lie outside the Feed’s date range, then return an
empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">See the notes for <code class="xref py py-func docutils literal notranslate"><span class="pre">compute_route_time_series_base()</span></code></p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN
direction ID values present</p>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_screen_line_counts">
<code class="descname">compute_screen_line_counts</code><span class="sig-paren">(</span><em>linestring: shapely.geometry.linestring.LineString, dates: List[str], geo_shapes=None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.compute_screen_line_counts" title="Permalink to this definition">¶</a></dt>
<dd><p>Find all the Feed trips active on the given dates
that intersect the given Shapely LineString (with WGS84
longitude-latitude coordinates).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>linestring</strong> (<em>Shapely LineString</em>) – </li>
<li><strong>dates</strong> (<em>list</em>) – YYYYMMDD date strings</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'date'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'trip_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_short_name'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'crossing_time'</span></code>: time that the trip’s vehicle crosses
the linestring; one trip could cross multiple times</li>
<li><code class="docutils literal notranslate"><span class="pre">'orientation'</span></code>: 1 or -1; 1 indicates trip travel from the
left side to the right side of the screen line;
-1 indicates trip travel in the  opposite direction</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">Requires GeoPandas</p>
</li>
<li><p class="first">The first step is to geometrize <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code> via
<a class="reference internal" href="#gtfstk.shapes.geometrize_shapes" title="gtfstk.shapes.geometrize_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">shapes.geometrize_shapes()</span></code></a>. Alternatively, use the
<code class="docutils literal notranslate"><span class="pre">geo_shapes</span></code> GeoDataFrame, if given.</p>
</li>
<li><p class="first">Assume <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> has an accurate
<code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> column.</p>
</li>
<li><p class="first">Assume that trips travel in the same direction as their
shapes. That restriction is part of GTFS, by the way.
To calculate direction quickly and accurately, assume that
the screen line is straight and doesn’t double back on itself.</p>
</li>
<li><p class="first">Probably does not give correct results for trips with
self-intersecting shapes.</p>
</li>
<li><p class="first">The algorithm works as follows</p>
<blockquote>
<div><ol class="arabic simple">
<li>Compute all the shapes that intersect the linestring</li>
<li>For each such shape, compute the intersection points</li>
<li>For each point p, scan through all the trips in the feed
that have that shape</li>
<li>For each date in <code class="docutils literal notranslate"><span class="pre">dates</span></code>, restrict to trips active on the
date and interpolate a stop time for p by assuming that the
feed has the shape_dist_traveled field in stop times</li>
<li>Use that interpolated time as the crossing time of the trip
vehicle, and compute the trip orientation to the screen line
via a cross product of a vector in the direction of the
screen line and a tiny vector in the direction of trip travel</li>
</ol>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code>, if <code class="docutils literal notranslate"><span class="pre">geo_shapes</span></code> is not given</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_stop_activity">
<code class="descname">compute_stop_activity</code><span class="sig-paren">(</span><em>dates: List[str]</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.compute_stop_activity" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark stops as active or inactive on the given dates.
A stop is <em>active</em> on a given date if some trips that starts on the
date visits the stop (possibly after midnight).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute activity</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are</p>
<ul class="simple">
<li>stop_id</li>
<li><code class="docutils literal notranslate"><span class="pre">dates[0]</span></code>: 1 if the stop has at least one trip visiting it
on <code class="docutils literal notranslate"><span class="pre">dates[0]</span></code>; 0 otherwise</li>
<li><code class="docutils literal notranslate"><span class="pre">dates[1]</span></code>: 1 if the stop has at least one trip visiting it
on <code class="docutils literal notranslate"><span class="pre">dates[1]</span></code>; 0 otherwise</li>
<li>etc.</li>
<li><code class="docutils literal notranslate"><span class="pre">dates[-1]</span></code>: 1 if the stop has at least one trip visiting it
on <code class="docutils literal notranslate"><span class="pre">dates[-1]</span></code>; 0 otherwise</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">If all dates lie outside the Feed period, then return an empty
DataFrame</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.compute_trip_activity" title="gtfstk.trips.compute_trip_activity"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.compute_trip_activity()</span></code></a></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_stop_stats">
<code class="descname">compute_stop_stats</code><span class="sig-paren">(</span><em>dates: List[str], stop_ids: Optional[List[str]] = None, headway_start_time: str = '07:00:00', headway_end_time: str = '19:00:00', *, split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.compute_stop_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute stats for all stops for the given dates.
Optionally, restrict to the stop IDs given.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>stop_ids</strong> (<em>list</em>) – Optional list of stop IDs to restrict stats to</li>
<li><strong>headway_start_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the start time for computing
headway stats</li>
<li><strong>headway_end_time</strong> (<em>string</em>) – HH:MM:SS time string indicating the end time for computing
headway stats</li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate the stop stats by direction (0 or 1)
of the trips visiting the stops; otherwise aggregate trips
visiting from both directions</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'date'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'stop_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code>: present if and only if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'num_routes'</span></code>: number of routes visiting the stop
(in the given direction) on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_trips'</span></code>: number of trips visiting stop
(in the givin direction) on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'max_headway'</span></code>: maximum of the durations (in minutes)
between trip departures at the stop between
<code class="docutils literal notranslate"><span class="pre">headway_start_time</span></code> and <code class="docutils literal notranslate"><span class="pre">headway_end_time</span></code> on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'min_headway'</span></code>: minimum of the durations (in minutes) mentioned
above</li>
<li><code class="docutils literal notranslate"><span class="pre">'mean_headway'</span></code>: mean of the durations (in minutes) mentioned
above</li>
<li><code class="docutils literal notranslate"><span class="pre">'start_time'</span></code>: earliest departure time of a trip from this stop
on the date</li>
<li><code class="docutils literal notranslate"><span class="pre">'end_time'</span></code>: latest departure time of a trip from this stop on
the date</li>
</ul>
<p>Exclude dates with no active stops, which could yield the empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
</ul>
</dd>
</dl>
</li>
<li>Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN
direction ID values present</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_stop_time_series">
<code class="descname">compute_stop_time_series</code><span class="sig-paren">(</span><em>dates: List[str], stop_ids: Optional[List[str]] = None, freq: str = '5Min', *, split_directions: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.compute_stop_time_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute time series for the stops on the given dates at the
given frequency and return the result as a DataFrame of the same
form as output by <code class="xref py py-func docutils literal notranslate"><span class="pre">stop_times.compute_stop_time_series_base()</span></code>.
Optionally restrict to stops in the given list of stop IDs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute stats</li>
<li><strong>stop_ids</strong> (<em>list</em>) – Optional list of stop IDs to restrict to</li>
<li><strong>split_directions</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then separate the stop stats by direction (0 or 1)
of the trips visiting the stops; otherwise aggregate trips
visiting from both directions</li>
<li><strong>freq</strong> (<em>Pandas frequency string</em>) – Specifices the frequency with which to resample the time series;
max frequency is one minute (‘Min’)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>A time series with a timestamp index across the given dates
sampled at the given frequency.
The maximum allowable frequency is 1 minute.</p>
<p>The columns are the same as in
<code class="xref py py-func docutils literal notranslate"><span class="pre">compute_stop_time_series_base()</span></code>.</p>
<p>Exclude dates that lie outside of the Feed’s date range.
If all dates lie outside the Feed’s date range, then return an
empty DataFrame</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">See the notes for <code class="xref py py-func docutils literal notranslate"><span class="pre">compute_stop_time_series_base()</span></code></p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Raise a ValueError if <code class="docutils literal notranslate"><span class="pre">split_directions</span></code> and no non-NaN
direction ID values present</p>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_trip_activity">
<code class="descname">compute_trip_activity</code><span class="sig-paren">(</span><em>dates: List[str]</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.compute_trip_activity" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark trip as active or inactive on the given dates as computed
by <a class="reference internal" href="#gtfstk.feed.Feed.is_active_trip" title="gtfstk.feed.Feed.is_active_trip"><code class="xref py py-func docutils literal notranslate"><span class="pre">is_active_trip()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>dates</strong> (<em>string</em><em> or </em><em>list</em>) – A YYYYMMDD date string or list thereof indicating the date(s)
for which to compute activity</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'trip_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">dates[0]</span></code>: 1 if the trip is active on <code class="docutils literal notranslate"><span class="pre">dates[0]</span></code>;
0 otherwise</li>
<li><code class="docutils literal notranslate"><span class="pre">dates[1]</span></code>: 1 if the trip is active on <code class="docutils literal notranslate"><span class="pre">dates[1]</span></code>;
0 otherwise</li>
<li>etc.</li>
<li><code class="docutils literal notranslate"><span class="pre">dates[-1]</span></code>: 1 if the trip is active on <code class="docutils literal notranslate"><span class="pre">dates[-1]</span></code>;
0 otherwise</li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">dates</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code> or the empty list, then return an
empty DataFrame.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.feed.Feed.is_active_trip" title="gtfstk.feed.Feed.is_active_trip"><code class="xref py py-func docutils literal notranslate"><span class="pre">is_active_trip()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.compute_trip_stats">
<code class="descname">compute_trip_stats</code><span class="sig-paren">(</span><em>route_ids: Optional[List[str]] = None</em>, <em>*</em>, <em>compute_dist_from_shapes: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.compute_trip_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame with the following columns:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'trip_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_short_name'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_type'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code>: NaN if missing from feed</li>
<li><code class="docutils literal notranslate"><span class="pre">'shape_id'</span></code>: NaN if missing from feed</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_stops'</span></code>: number of stops on trip</li>
<li><code class="docutils literal notranslate"><span class="pre">'start_time'</span></code>: first departure time of the trip</li>
<li><code class="docutils literal notranslate"><span class="pre">'end_time'</span></code>: last departure time of the trip</li>
<li><code class="docutils literal notranslate"><span class="pre">'start_stop_id'</span></code>: stop ID of the first stop of the trip</li>
<li><code class="docutils literal notranslate"><span class="pre">'end_stop_id'</span></code>: stop ID of the last stop of the trip</li>
<li><code class="docutils literal notranslate"><span class="pre">'is_loop'</span></code>: 1 if the start and end stop are less than 400m apart and
0 otherwise</li>
<li><code class="docutils literal notranslate"><span class="pre">'distance'</span></code>: distance of the trip in <code class="docutils literal notranslate"><span class="pre">feed.dist_units</span></code>;
contains all <code class="docutils literal notranslate"><span class="pre">np.nan</span></code> entries if <code class="docutils literal notranslate"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'duration'</span></code>: duration of the trip in hours</li>
<li><code class="docutils literal notranslate"><span class="pre">'speed'</span></code>: distance/duration</li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> has a <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> column with at
least one non-NaN value and <code class="docutils literal notranslate"><span class="pre">compute_dist_from_shapes</span> <span class="pre">==</span> <span class="pre">False</span></code>,
then use that column to compute the distance column.
Else if <code class="docutils literal notranslate"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></code>, then compute the distance
column using the shapes and Shapely.
Otherwise, set the distances to NaN.</p>
<p>If route IDs are given, then restrict to trips on those routes.</p>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code> (optionally)</li>
<li>Those used in <a class="reference internal" href="#gtfstk.stops.build_geometry_by_stop" title="gtfstk.stops.build_geometry_by_stop"><code class="xref py py-func docutils literal notranslate"><span class="pre">stops.build_geometry_by_stop()</span></code></a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Calculating trip distances with <code class="docutils literal notranslate"><span class="pre">compute_dist_from_shapes=True</span></code>
seems pretty accurate.  For example, calculating trip distances on
<a class="reference external" href="https://transitfeeds.com/p/trimet/43/1400947517">this Portland feed</a>
using <code class="docutils literal notranslate"><span class="pre">compute_dist_from_shapes=False</span></code> and
<code class="docutils literal notranslate"><span class="pre">compute_dist_from_shapes=True</span></code>,
yields a difference of at most 0.83km from the original values.</p>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.convert_dist">
<code class="descname">convert_dist</code><span class="sig-paren">(</span><em>new_dist_units: str</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.convert_dist" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the distances recorded in the <code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code>
columns of the given Feed to the given distance units.
New distance units must lie in <code class="xref py py-const docutils literal notranslate"><span class="pre">constants.DIST_UNITS</span></code>.
Return the resulting feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.copy">
<code class="descname">copy</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; gtfstk.feed.Feed<a class="headerlink" href="#gtfstk.feed.Feed.copy" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a copy of this feed, that is, a feed with all the same
attributes.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.create_shapes">
<code class="descname">create_shapes</code><span class="sig-paren">(</span><em>*</em>, <em>all_trips: bool = False</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.create_shapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a feed, create a shape for every trip that is missing a
shape ID.
Do this by connecting the stops on the trip with straight lines.
Return the resulting feed which has updated shapes and trips
tables.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">all_trips</span></code>, then create new shapes for all trips by
connecting stops, and remove the old shapes.</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.describe">
<code class="descname">describe</code><span class="sig-paren">(</span><em>sample_date: Optional[str] = None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.describe" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame of various feed indicators and values,
e.g. number of routes.
Specialize some those indicators to the given sample date,
e.g. number of routes active on the date.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>sample_date</strong> (<em>string</em>) – YYYYMMDD date string specifying the date to compute sample
stats; defaults to the first Thursday of the Feed’s period</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>The columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'indicator'</span></code>: string; name of an indicator, e.g. ‘num_routes’</li>
<li><code class="docutils literal notranslate"><span class="pre">'value'</span></code>: value of the indicator, e.g. 27</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gtfstk.feed.Feed.dist_units">
<code class="descname">dist_units</code><a class="headerlink" href="#gtfstk.feed.Feed.dist_units" title="Permalink to this definition">¶</a></dt>
<dd><p>The distance units of the Feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.drop_invalid_columns">
<code class="descname">drop_invalid_columns</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.drop_invalid_columns" title="Permalink to this definition">¶</a></dt>
<dd><p>Drop all DataFrame columns of the given Feed that are not
listed in the GTFS.
Return the resulting new “Feed”.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.drop_zombies">
<code class="descname">drop_zombies</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.drop_zombies" title="Permalink to this definition">¶</a></dt>
<dd><p>In the given Feed, do the following in order:</p>
<ol class="arabic simple">
<li>Drop stops of location type 0 or NaN with no stop times.</li>
<li>Remove undefined parent stations from the <code class="docutils literal notranslate"><span class="pre">parent_station</span></code> column.</li>
<li>Drop trips with no stop times.</li>
<li>Drop shapes with no trips.</li>
<li>Drop routes with no trips.</li>
<li>Drop services with no trips.</li>
</ol>
<p>Return the resulting Feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_dates">
<code class="descname">get_dates</code><span class="sig-paren">(</span><em>*</em>, <em>as_date_obj: bool = False</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="headerlink" href="#gtfstk.feed.Feed.get_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of dates for which the given “Feed” is valid, which
could be the empty list if the “Feed” has no calendar information.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<em>&quot;Feed&quot;</em>) – </li>
<li><strong>as_date_obj</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then return the dates as <code class="docutils literal notranslate"><span class="pre">datetime.date</span></code> objects;
otherwise return them as strings</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Dates</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_first_week">
<code class="descname">get_first_week</code><span class="sig-paren">(</span><em>*</em>, <em>as_date_obj: bool = False</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="headerlink" href="#gtfstk.feed.Feed.get_first_week" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of dates for the first Monday–Sunday
week (or initial segment thereof) for which this feed is valid.
If the feed has no Mondays, then return the empty list.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">as_date_obj</span></code>, then return date objects, otherwise return date strings.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_routes">
<code class="descname">get_routes</code><span class="sig-paren">(</span><em>date: Optional[str] = None</em>, <em>time: Optional[str] = None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.get_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a subset of <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string restricting routes to only those active on
the date</li>
<li><strong>time</strong> (<em>string</em>) – HH:MM:SS time string, possibly with HH &gt; 23, restricting routes
to only those active during the time</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A subset of <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a>.</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_shapes_intersecting_geometry">
<code class="descname">get_shapes_intersecting_geometry</code><span class="sig-paren">(</span><em>geometry</em>, <em>geo_shapes=None</em>, <em>*</em>, <em>geometrized: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.get_shapes_intersecting_geometry" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the slice of <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code> that contains all shapes that
intersect the given Shapely geometry, e.g. a Polygon or LineString.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>geometry</strong> (<em>Shapley geometry</em><em>, </em><em>e.g. a Polygon</em>) – Specified in WGS84 coordinates</li>
<li><strong>geo_shapes</strong> (<em>GeoPandas GeoDataFrame</em>) – The output of <code class="xref py py-func docutils literal notranslate"><span class="pre">geometrize_shapes()</span></code></li>
<li><strong>geometrize</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then return the shapes DataFrame as a GeoDataFrame
of the form output by <code class="xref py py-func docutils literal notranslate"><span class="pre">geometrize_shapes()</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame or GeoDataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">Requires GeoPandas</p>
</li>
<li><p class="first">Specifying <code class="docutils literal notranslate"><span class="pre">geo_shapes</span></code> will skip the first step of the
algorithm, namely, geometrizing <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code></p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code>, if <code class="docutils literal notranslate"><span class="pre">geo_shapes</span></code> is not given</li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_start_and_end_times">
<code class="descname">get_start_and_end_times</code><span class="sig-paren">(</span><em>date: Optional[str] = None</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="headerlink" href="#gtfstk.feed.Feed.get_start_and_end_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the first departure time and last arrival time
(HH:MM:SS time strings) listed in <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code>, respectively.
Restrict to the given date (YYYYMMDD string) if specified.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_stop_times">
<code class="descname">get_stop_times</code><span class="sig-paren">(</span><em>date: Optional[str] = None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.get_stop_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a subset of <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string restricting the output to trips active
on the date</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Subset of <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.trips.get_trips" title="gtfstk.trips.get_trips"><code class="xref py py-func docutils literal notranslate"><span class="pre">trips.get_trips()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_stops">
<code class="descname">get_stops</code><span class="sig-paren">(</span><em>date: Optional[str] = None</em>, <em>trip_id: Optional[str] = None</em>, <em>route_id: Optional[str] = None</em>, <em>*</em>, <em>in_stations: bool = False</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.get_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a section of <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD string; restricts the output to stops active
(visited by trips) on the date</li>
<li><strong>trip_id</strong> (<em>string</em>) – ID of a trip in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code>; restricts output to stops
visited by the trip</li>
<li><strong>route_id</strong> (<em>string</em>) – ID of route in <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code>; restricts output to stops
visited by the route</li>
<li><strong>in_stations</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then restricts output to stops in stations if
station data is available in <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A subset of <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code> defined by the parameters above</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stop_times.get_stop_times" title="gtfstk.stop_times.get_stop_times"><code class="xref py py-func docutils literal notranslate"><span class="pre">stop_times.get_stop_times()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_stops_in_polygon">
<code class="descname">get_stops_in_polygon</code><span class="sig-paren">(</span><em>polygon: shapely.geometry.polygon.Polygon</em>, <em>geo_stops=None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.get_stops_in_polygon" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the slice of <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code> that contains all stops that lie
within the given Shapely Polygon object that is specified in
WGS84 coordinates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>polygon</strong> (<em>Shapely Polygon</em>) – Specified in WGS84 coordinates</li>
<li><strong>geo_stops</strong> (<em>Geopandas GeoDataFrame</em>) – A geographic version of <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code> which will be computed
if not given.
Specify this parameter in batch jobs to avoid unnecessary
computation.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Subset of <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">Requires GeoPandas</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stops</span></code>, if <code class="docutils literal notranslate"><span class="pre">geo_stops</span></code> is not given</li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_trips">
<code class="descname">get_trips</code><span class="sig-paren">(</span><em>date: Optional[str] = None</em>, <em>time: Optional[str] = None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.get_trips" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a subset of <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string</li>
<li><strong>time</strong> (<em>string</em>) – HH:MM:SS time string, possibly with HH &gt; 23</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The subset of <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code> containing trips active (starting)
on the given date at the given time.
If no date or time are specified, then return the entire
<code class="docutils literal notranslate"><span class="pre">feed.trips</span></code>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.get_week">
<code class="descname">get_week</code><span class="sig-paren">(</span><em>k: int</em>, <em>*</em>, <em>as_date_obj: bool = False</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="headerlink" href="#gtfstk.feed.Feed.get_week" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a Feed object and a positive integer <code class="docutils literal notranslate"><span class="pre">k</span></code>,
return a list of dates corresponding to the kth Monday–Sunday week
(or initial segment thereof) for which the feed is valid.
For example, k=1 returns the first Monday–Sunday week (or initial segment thereof).
If the feed not have k Mondays, then return the empty list.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">as_date_obj</span></code>, then return date objects, otherwise return date strings.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.is_active_trip">
<code class="descname">is_active_trip</code><span class="sig-paren">(</span><em>trip_id: str</em>, <em>date: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#gtfstk.feed.Feed.is_active_trip" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the <code class="docutils literal notranslate"><span class="pre">feed.calendar</span></code> or <code class="docutils literal notranslate"><span class="pre">feed.calendar_dates</span></code>
says that the trip runs on the given date; return <code class="docutils literal notranslate"><span class="pre">False</span></code>
otherwise.</p>
<p>Note that a trip that starts on date d, ends after 23:59:59, and
does not start again on date d+1 is considered active on date d and
not active on date d+1.
This subtle point, which is a side effect of the GTFS, can
lead to confusion.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_id</strong> (<em>string</em>) – ID of a trip in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><code class="docutils literal notranslate"><span class="pre">True</span></code> if and only if the given trip starts on the given
date.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">boolean</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul>
<li><p class="first">This function is key for getting all trips, routes, etc. that are
active on a given date, so the function needs to be fast</p>
</li>
<li><p class="first">Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.locate_trips">
<code class="descname">locate_trips</code><span class="sig-paren">(</span><em>date: str, times: List[str]</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.locate_trips" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the positions of all trips active on the
given date and times</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string</li>
<li><strong>times</strong> (<em>list</em>) – HH:MM:SS time strings, possibly with HH &gt; 23</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'trip_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'route_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'direction_id'</span></code>: all NaNs if <code class="docutils literal notranslate"><span class="pre">feed.trips.direction_id</span></code> is
missing</li>
<li><code class="docutils literal notranslate"><span class="pre">'time'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'rel_dist'</span></code>: number between 0 (start) and 1 (end)
indicating the relative distance of the trip along its path</li>
<li><code class="docutils literal notranslate"><span class="pre">'lon'</span></code>: longitude of trip at given time</li>
<li><code class="docutils literal notranslate"><span class="pre">'lat'</span></code>: latitude of trip at given time</li>
</ul>
<p>Assume <code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code> has an accurate
<code class="docutils literal notranslate"><span class="pre">shape_dist_traveled</span></code> column.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stop_times.get_stop_times" title="gtfstk.stop_times.get_stop_times"><code class="xref py py-func docutils literal notranslate"><span class="pre">stop_times.get_stop_times()</span></code></a></li>
<li>Those used in <a class="reference internal" href="#gtfstk.shapes.build_geometry_by_shape" title="gtfstk.shapes.build_geometry_by_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">shapes.build_geometry_by_shape()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.map_routes">
<code class="descname">map_routes</code><span class="sig-paren">(</span><em>route_ids: List[str], date: Optional[str] = None, color_palette: List[str] = ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f', '#e5c494', '#b3b3b3'], *, include_stops: bool = True</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.map_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Folium map showing the given routes and (optionally)
their stops.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>route_ids</strong> (<em>list</em>) – IDs of routes in <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string restricting the output to trips active
on the date</li>
<li><strong>color_palette</strong> (<em>list</em>) – Palette to use to color the routes. If more routes than colors,
then colors will be recycled.</li>
<li><strong>include_stops</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then include stops in the map</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A Folium Map depicting the distinct shapes of the trips on
each route.
If <code class="docutils literal notranslate"><span class="pre">include_stops</span></code>, then include the stops for each route.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>Requires Folium</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.map_stops">
<code class="descname">map_stops</code><span class="sig-paren">(</span><em>stop_ids: List[str], stop_style: Dict = {'color': '#fc8d62', 'fill': True, 'fill_opacity': 0.75, 'radius': 8, 'weight': 1}</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.map_stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Folium map showing the given stops.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>stop_ids</strong> (<em>list</em>) – IDs of trips in <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
<li><strong>stop_style</strong> (<em>dictionary</em>) – Folium CircleMarker parameters to use for styling stops.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A Folium Map depicting the stops as CircleMarkers.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>Requires Folium</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.map_trips">
<code class="descname">map_trips</code><span class="sig-paren">(</span><em>trip_ids: List[str], color_palette: List[str] = ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f', '#e5c494', '#b3b3b3'], *, include_stops: bool = True</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfstk.feed.Feed.map_trips" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a Folium map showing the given trips and (optionally)
their stops.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_ids</strong> (<em>list</em>) – IDs of trips in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><strong>color_palette</strong> (<em>list</em>) – Palette to use to color the routes. If more routes than colors,
then colors will be recycled.</li>
<li><strong>include_stops</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then include stops in the map</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A Folium Map depicting the shapes of the trips.
If <code class="docutils literal notranslate"><span class="pre">include_stops</span></code>, then include the stops for each trip.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>Requires Folium</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.restrict_to_dates">
<code class="descname">restrict_to_dates</code><span class="sig-paren">(</span><em>dates: List[str]</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.restrict_to_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a new feed by restricting this one to only the stops,
trips, shapes, etc. active on at least one of the given dates
(YYYYMMDD strings).
Return the resulting feed, which will have empty non-agency tables
if no trip is active on any of the given dates.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.restrict_to_polygon">
<code class="descname">restrict_to_polygon</code><span class="sig-paren">(</span><em>polygon: shapely.geometry.polygon.Polygon</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.restrict_to_polygon" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a new feed by restricting this one to only the trips
that have at least one stop intersecting the given Shapely polygon,
then restricting stops, routes, stop times, etc. to those
associated with that subset of trips.
Return the resulting feed.</p>
<p>Requires GeoPandas.</p>
<p>Assume the following feed attributes are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feed.stop_times</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.stops</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li>Those used in <a class="reference internal" href="#gtfstk.stops.get_stops_in_polygon" title="gtfstk.stops.get_stops_in_polygon"><code class="xref py py-func docutils literal notranslate"><span class="pre">stops.get_stops_in_polygon()</span></code></a></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.restrict_to_routes">
<code class="descname">restrict_to_routes</code><span class="sig-paren">(</span><em>route_ids: List[str]</em><span class="sig-paren">)</span> &#x2192; Feed<a class="headerlink" href="#gtfstk.feed.Feed.restrict_to_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a new feed by restricting this one to only the stops,
trips, shapes, etc. used by the routes with the given list of
route IDs.
Return the resulting feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.route_to_geojson">
<code class="descname">route_to_geojson</code><span class="sig-paren">(</span><em>route_id: str</em>, <em>date: Optional[str] = None</em>, <em>*</em>, <em>include_stops: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#gtfstk.feed.Feed.route_to_geojson" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a GeoJSON rendering of the route and, optionally, its stops.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>route_id</strong> (<em>string</em>) – ID of a route in <code class="docutils literal notranslate"><span class="pre">feed.routes</span></code></li>
<li><strong>date</strong> (<em>string</em>) – YYYYMMDD date string restricting the output to trips active
on the date</li>
<li><strong>include_stops</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then include stop features in the result</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A decoded GeoJSON feature collection comprising a
LineString features of the distinct shapes of the trips on the
route.
If <code class="docutils literal notranslate"><span class="pre">include_stops</span></code>, then include one Point feature for
each stop on the route.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.shapes_to_geojson">
<code class="descname">shapes_to_geojson</code><span class="sig-paren">(</span><em>shape_ids: Optional[List[str]] = None</em><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#gtfstk.feed.Feed.shapes_to_geojson" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a (decoded) GeoJSON FeatureCollection of LineString features
representing <code class="docutils literal notranslate"><span class="pre">feed.shapes</span></code>.
Each feature will have a <code class="docutils literal notranslate"><span class="pre">shape_id</span></code> property.
The coordinates reference system is the default one for GeoJSON,
namely WGS84.</p>
<p>If a list of shape IDs is given, then return only the LineString
features corresponding to those shape IDS.
Return the empty dictionary if <code class="docutils literal notranslate"><span class="pre">feed.shapes</span> <span class="pre">is</span> <span class="pre">None</span></code></p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.subset_dates">
<code class="descname">subset_dates</code><span class="sig-paren">(</span><em>dates: List[str]</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="headerlink" href="#gtfstk.feed.Feed.subset_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a “Feed” and a list of dates (YYYYMMDD date strings),
return the sublist of dates that lie in the Feed’s dates
(the output <code class="xref py py-func docutils literal notranslate"><span class="pre">feed.get_dates()</span></code>).</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.summarize">
<code class="descname">summarize</code><span class="sig-paren">(</span><em>table: str = None</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.Feed.summarize" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DataFrame summarizing all GTFS tables in the given feed
or in the given table if specified.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>table</strong> (<em>string</em>) – A GTFS table name, e.g. <code class="docutils literal notranslate"><span class="pre">'stop_times'</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Columns are</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'table'</span></code>: name of the GTFS table, e.g. <code class="docutils literal notranslate"><span class="pre">'stops'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'column'</span></code>: name of a column in the table,
e.g. <code class="docutils literal notranslate"><span class="pre">'stop_id'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'num_values'</span></code>: number of values in the column</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_nonnull_values'</span></code>: number of nonnull values in the
column</li>
<li><code class="docutils literal notranslate"><span class="pre">'num_unique_values'</span></code>: number of unique values in the
column, excluding null values</li>
<li><code class="docutils literal notranslate"><span class="pre">'min_value'</span></code>: minimum value in the column</li>
<li><code class="docutils literal notranslate"><span class="pre">'max_value'</span></code>: maximum value in the column</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>If the table is not in the feed, then return an empty DataFrame</li>
<li>If the table is not valid, raise a ValueError</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.trip_to_geojson">
<code class="descname">trip_to_geojson</code><span class="sig-paren">(</span><em>trip_id: str</em>, <em>*</em>, <em>include_stops: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#gtfstk.feed.Feed.trip_to_geojson" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a GeoJSON representation of the given trip, optionally with
its stops.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>trip_id</strong> (<em>string</em>) – ID of trip in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code></li>
<li><strong>include_stops</strong> (<em>boolean</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>A (decoded) GeoJSON FeatureCollection comprising a Linestring
feature representing the trip’s shape.
If <code class="docutils literal notranslate"><span class="pre">include_stops</span></code>, then also include one Point feature for
each stop  visited by the trip.
The Linestring feature will contain as properties all the
columns in <code class="docutils literal notranslate"><span class="pre">feed.trips</span></code> pertaining to the given trip,
and each Point feature will contain as properties all the
columns in <code class="docutils literal notranslate"><span class="pre">feed.stops</span></code> pertaining to the stop,
except the <code class="docutils literal notranslate"><span class="pre">stop_lat</span></code> and <code class="docutils literal notranslate"><span class="pre">stop_lon</span></code> properties.</p>
<p>Return the empty dictionary if the trip has no shape.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dictionary</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gtfstk.feed.Feed.trips">
<code class="descname">trips</code><a class="headerlink" href="#gtfstk.feed.Feed.trips" title="Permalink to this definition">¶</a></dt>
<dd><p>The trips table of this Feed.</p>
</dd></dl>

<dl class="method">
<dt id="gtfstk.feed.Feed.validate">
<code class="descname">validate</code><span class="sig-paren">(</span><em>*</em>, <em>as_df: bool = True</em>, <em>include_warnings: bool = True</em><span class="sig-paren">)</span> &#x2192; Union[List, pandas.core.frame.DataFrame]<a class="headerlink" href="#gtfstk.feed.Feed.validate" title="Permalink to this definition">¶</a></dt>
<dd><p>Check whether the given feed satisfies the GTFS.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feed</strong> (<a class="reference internal" href="index.html#gtfstk.feed.Feed" title="gtfstk.feed.Feed"><em>Feed</em></a>) – </li>
<li><strong>as_df</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then return the resulting report as a DataFrame;
otherwise return the result as a list</li>
<li><strong>include_warnings</strong> (<em>boolean</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then include problems of types <code class="docutils literal notranslate"><span class="pre">'error'</span></code> and
<code class="docutils literal notranslate"><span class="pre">'warning'</span></code>; otherwise, only return problems of type
<code class="docutils literal notranslate"><span class="pre">'error'</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Run all the table-checking functions: <a class="reference internal" href="#gtfstk.feed.Feed.check_agency" title="gtfstk.feed.Feed.check_agency"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_agency()</span></code></a>,
<a class="reference internal" href="#gtfstk.feed.Feed.check_calendar" title="gtfstk.feed.Feed.check_calendar"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_calendar()</span></code></a>, etc.
This yields a possibly empty list of items
[problem type, message, table, rows].
If <code class="docutils literal notranslate"><span class="pre">as_df</span></code>, then format the error list as a DataFrame with the
columns</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'type'</span></code>: ‘error’ or ‘warning’; ‘error’ means the GTFS is
violated; ‘warning’ means there is a problem but it’s not a
GTFS violation</li>
<li><code class="docutils literal notranslate"><span class="pre">'message'</span></code>: description of the problem</li>
<li><code class="docutils literal notranslate"><span class="pre">'table'</span></code>: table in which problem occurs, e.g. ‘routes’</li>
<li><code class="docutils literal notranslate"><span class="pre">'rows'</span></code>: rows of the table’s DataFrame where problem occurs</li>
</ul>
<p>Return early if the feed is missing required tables or required
columns.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list or DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>This function interprets the GTFS liberally, classifying problems
as warnings rather than errors where the GTFS is unclear.
For example if a trip_id listed in the trips table is not listed
in the stop times table (a trip with no stop times),
then that’s a warning and not an error.</li>
<li>Timing benchmark: on a 2.80 GHz processor machine with 16 GB of
memory, this function checks <a class="reference external" href="http://transitfeeds.com/p/translink/21/20170310">this 31 MB Southeast Queensland feed</a>
in 22 seconds, including warnings.</li>
</ul>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="gtfstk.feed.list_gtfs">
<code class="descclassname">gtfstk.feed.</code><code class="descname">list_gtfs</code><span class="sig-paren">(</span><em>path: pathlib.Path</em><span class="sig-paren">)</span> &#x2192; pandas.core.frame.DataFrame<a class="headerlink" href="#gtfstk.feed.list_gtfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a path (string or Path object) to a GTFS zip file or
directory, record the file names and file sizes of the contents,
and return the result in a DataFrame with the columns:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'file_name'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'file_size'</span></code></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.feed.read_gtfs">
<code class="descclassname">gtfstk.feed.</code><code class="descname">read_gtfs</code><span class="sig-paren">(</span><em>path: pathlib.Path</em>, <em>dist_units: str</em><span class="sig-paren">)</span> &#x2192; gtfstk.feed.Feed<a class="headerlink" href="#gtfstk.feed.read_gtfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a Feed instance from the given path and given distance units.
The path should be a directory containing GTFS text files or a
zip file that unzips as a collection of GTFS text files
(and not as a directory containing GTFS text files).
The distance units given must lie in <code class="xref py py-const docutils literal notranslate"><span class="pre">constants.dist_units</span></code></p>
<p class="rubric">Notes</p>
<ul class="simple">
<li>Ignore non-GTFS files</li>
<li>Automatically strip whitespace from the column names in GTFS files</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="gtfstk.feed.write_gtfs">
<code class="descclassname">gtfstk.feed.</code><code class="descname">write_gtfs</code><span class="sig-paren">(</span><em>feed: gtfstk.feed.Feed</em>, <em>path: pathlib.Path</em>, <em>ndigits: int = 6</em><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#gtfstk.feed.write_gtfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Export the given feed to the given path.
If the path end in ‘.zip’, then write the feed as a zip archive.
Otherwise assume the path is a directory, and write the feed as a
collection of CSV files to that directory, creating the directory
if it does not exist.
Round all decimals to <code class="docutils literal notranslate"><span class="pre">ndigits</span></code> decimal places.
All distances will be the distance units <code class="docutils literal notranslate"><span class="pre">feed.dist_units</span></code>.</p>
</dd></dl>

</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">GTFSTK 10.0.4 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>